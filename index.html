<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foco Bursátil - Herramientas Financieras</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0/dist/chartjs-plugin-annotation.min.js"></script>

    <style>
        /* Custom styles for the application */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0D1117;
        }
        #particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .tradingview-widget-container__widget {
            height: 100%;
            width: 100%;
        }
        #mobile-menu {
            transition: transform 0.3s ease-in-out;
        }
        
        /* --- Integrated Icon Ticker Styles --- */
        .icon-ticker-wrapper {
            flex-grow: 1;
            overflow: hidden;
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        }

        #home-icon-bar {
            display: flex;
            width: max-content;
            animation: scroll 80s linear infinite;
        }

        #home-icon-bar:hover {
            animation-play-state: paused;
        }

        @keyframes scroll {
            from { transform: translateX(0); }
            to { transform: translateX(-50%); }
        }

        .home-icon-link {
            flex-shrink: 0;
            margin: 0 1.5rem;
        }

        /* --- Active Icon State --- */
        .home-icon-link.active > div {
            border-color: #3B82F6;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }
         .home-icon-link.active > span {
            color: #F9FAFB;
        }

        /* --- Loading Spinner Styles --- */
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #FFF;
            border-bottom-color: #3B82F6;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- Page Transition Styles --- */
        .page {
            transition: opacity 0.3s ease-in-out;
        }
        .page.fade-out { opacity: 0; }
        .page.fade-in { opacity: 1; }

        /* --- Education Module Styles --- */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 40vh;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .btn {
            transition: all 0.2s ease-in-out;
        }
        #anatomy-description {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        #anatomy-description.fade-out {
            opacity: 0;
            transform: translateY(10px);
        }
         .card {
            background-color: #1f2937;
            border: 1px solid #374151;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body class="text-gray-200">

    <canvas id="particle-canvas"></canvas>

    <!-- Stock Ticker Tape -->
    <div class="tradingview-widget-container">
      <div class="tradingview-widget-container__widget"></div>
      <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
      { "symbols": [ { "proName": "FOREXCOM:SPXUSD", "title": "S&P 500" }, { "proName": "FOREXCOM:NSXUSD", "title": "US 100" }, { "proName": "BITSTAMP:BTCUSD", "title": "Bitcoin" }, { "proName": "BITSTAMP:ETHUSD", "title": "Ethereum" }, { "proName": "BCS:SP_IPSA", "title": "IPSA" }, { "proName": "BCS:SQM_B", "title": "SQM-B" }, { "proName": "BCS:COPEC", "title": "COPEC" }, { "proName": "FX_IDC:USDCLP", "title": "USD/CLP" } ], "colorTheme": "dark", "locale": "es", "isTransparent": false, "showSymbolLogo": true, "displayMode": "adaptive" }
      </script>
    </div>

    <!-- Main Navigation Bar -->
    <header class="bg-gray-900/80 backdrop-blur-sm sticky top-0 z-40 border-b border-gray-700">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <a href="#" id="logo-link" class="text-xl font-bold text-white flex-shrink-0 pr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                </a>
                <div class="icon-ticker-wrapper">
                    <div id="home-icon-bar"></div>
                </div>
                <div class="md:hidden flex-shrink-0 pl-4">
                    <button id="mobile-menu-button" class="text-gray-300 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Menu (Sidebar) -->
    <div id="mobile-menu" class="fixed top-0 right-0 h-full w-64 bg-gray-900 z-50 transform translate-x-full md:hidden p-6 border-l border-gray-700">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-lg font-semibold text-white">Menú</h2>
            <button id="close-mobile-menu" class="text-gray-400 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <nav id="mobile-nav-links" class="flex flex-col space-y-4"></nav>
    </div>

    <!-- Home Page with Cards -->
    <main id="home-page" class="page container mx-auto px-4 sm:px-6 lg:px-8 py-16 sm:py-24">
        <div class="text-center mb-16">
            <div class="flex justify-center items-center gap-4 sm:gap-8">
                <div class="text-right">
                    <h1 class="text-4xl sm:text-5xl font-bold text-white tracking-tight">El Pulso del Mercado</h1>
                    <p class="mt-2 text-base sm:text-lg text-gray-400">Todas las herramientas que necesitas, en un solo lugar.</p>
                </div>
                <img src="https://github.com/amolinad22/foco-bursatil-web/blob/main/logo%20redondo%202.png?raw=true" alt="Foco Bursátil Logo" class="h-36 sm:h-56 w-auto flex-shrink-0" onerror="this.onerror=null;this.src='https://placehold.co/150x50/0D1117/FFFFFF?text=Logo';">
            </div>
        </div>
        <div id="home-cards-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 relative z-10"></div>
    </main>

    <!-- Tools Container -->
    <main id="tools-page-container" class="page container mx-auto px-4 sm:px-6 lg:px-8 py-12" style="display: none;">
        <div id="tools-content-container"></div>
    </main>

    <!-- Content Templates for Tools -->
    <template id="template-panorama-market-page">
        <div class="text-center mb-12"><h1 class="text-4xl font-bold text-white">Panorama del Mercado</h1><p class="mt-2 text-lg text-gray-400">Un vistazo general a los principales mercados.</p></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8"><div class="w-full h-[650px]"><div class="tradingview-widget-container__widget" data-widget-type="market-overview"></div></div></div>
    </template>
    <template id="template-analisis-tecnico-page">
        <div class="text-center mb-12"><h1 class="text-4xl font-bold text-white">Análisis Técnico</h1><p class="mt-2 text-lg text-gray-400">Gráfico avanzado para analizar tus activos favoritos.</p></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-4"><div class="h-[75vh]"><div class="tradingview-widget-container__widget" data-widget-type="advanced-chart"></div></div></div>
    </template>
    <template id="template-chile-market-page">
        <div class="text-center mb-12">
            <div class="inline-flex items-center justify-center">
                <img src="https://flagcdn.com/cl.svg" width="40" alt="Bandera de Chile" class="mr-4">
                <h1 class="text-4xl font-bold text-white">Chile</h1>
            </div>
            <p class="mt-2 text-lg text-gray-400">Mapa de Calor y análisis de las acciones chilenas.</p>
            <p class="mt-2 text-sm text-gray-500 italic">La información de mercado presenta un desfase de 20 minutos.</p>
        </div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8 mb-12"><div class="h-[700px]"><div class="tradingview-widget-container__widget" data-widget-type="heatmap-cl"></div></div></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8"><h2 class="text-2xl font-semibold text-white mb-4 text-center">Acciones Más Activas</h2><div class="h-[550px]"><div class="tradingview-widget-container__widget" data-widget-type="hotlists-cl"></div></div></div>
    </template>
    <template id="template-usa-market-page">
        <div class="text-center mb-12"><div class="inline-flex items-center justify-center"><img src="https://flagcdn.com/us.svg" width="40" alt="Bandera de EE.UU." class="mr-4"><h1 class="text-4xl font-bold text-white">USA</h1></div><p class="mt-2 text-lg text-gray-400">Mapa de Calor del S&P 500 y las acciones más activas.</p></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8 mb-12"><div class="h-[700px]"><div class="tradingview-widget-container__widget" data-widget-type="heatmap-us"></div></div></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8"><h2 class="text-2xl font-semibold text-white mb-4 text-center">Acciones Más Activas</h2><div class="h-[550px]"><div class="tradingview-widget-container__widget" data-widget-type="hotlists-us"></div></div></div>
    </template>
    <template id="template-crypto-page">
        <div class="text-center mb-12"><h1 class="text-4xl font-bold text-white">Mercado de Cryptomonedas</h1><p class="mt-2 text-lg text-gray-400">Visualiza el rendimiento con nuestro mapa de calor y screener.</p></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8 mb-12"><div class="h-[700px]"><div class="tradingview-widget-container__widget" data-widget-type="crypto-coins-heatmap"></div></div></div>
        <div class="text-center mb-12"><h2 class="text-3xl font-bold text-white">Screener de Cryptomonedas</h2><p class="mt-2 text-lg text-gray-400">Filtra y encuentra cryptomonedas según tus criterios.</p></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8"><div class="h-[80vh]"><div class="tradingview-widget-container__widget" data-widget-type="crypto-screener"></div></div></div>
    </template>
    <template id="template-noticias-page">
        <div class="text-center mb-12"><h1 class="text-4xl font-bold text-white">Noticias del Mercado</h1><p class="mt-2 text-lg text-gray-400">Las últimas noticias que mueven los mercados.</p></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8"><div class="h-[80vh]"><div class="tradingview-widget-container__widget" data-widget-type="timeline"></div></div></div>
    </template>
    <template id="template-calendario-page">
        <div class="text-center mb-12"><h1 class="text-4xl font-bold text-white">Calendario Económico</h1><p class="mt-2 text-lg text-gray-400">Anticípate a los eventos clave.</p></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-2 md:p-4"><div class="h-[80vh]"><div class="tradingview-widget-container__widget" data-widget-type="economic-calendar"></div></div></div>
    </template>
    <template id="template-educacion-page">
        <div class="text-gray-300">
             <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-bold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-purple-500">El Patrón de Triángulo Simétrico</h1>
                <p class="text-lg text-gray-400 max-w-3xl mx-auto">Una guía interactiva para identificar, entender y operar uno de los patrones de consolidación más fiables del análisis técnico.</p>
            </div>

            <!-- Section 1: Anatomy of the Pattern -->
            <div class="card">
                <h2 class="text-2xl font-bold mb-4 text-white">Anatomía del Patrón</h2>
                <p class="mb-6 text-gray-400">Esta sección desglosa los componentes clave de un triángulo simétrico. Haz clic en cada botón para resaltar y entender las diferentes partes del patrón en el gráfico interactivo.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="md:col-span-2">
                        <canvas id="anatomyChart"></canvas>
                    </div>
                    <div>
                        <div id="anatomy-buttons" class="flex flex-wrap gap-2 mb-4">
                            <button class="btn" data-component="lines">Líneas Convergentes</button>
                            <button class="btn" data-component="points">Puntos de Contacto</button>
                            <button class="btn" data-component="volume">Volumen Decreciente</button>
                            <button class="btn" data-component="breakout">La Ruptura (Breakout)</button>
                        </div>
                        <div id="anatomy-description" class="p-4 bg-gray-800 rounded-lg min-h-[150px] border border-gray-700">
                            <p class="text-gray-300">Selecciona un componente para ver su descripción aquí.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 2: Market Psychology -->
            <div class="card">
                <h2 class="text-2xl font-bold mb-4 text-white">La Psicología del Mercado</h2>
                <p class="mb-6 text-gray-400">El triángulo simétrico es más que una simple forma en un gráfico; representa una batalla temporalmente equilibrada entre las fuerzas de la oferta y la demanda.</p>
                <div class="flex flex-col md:flex-row items-center justify-center gap-8">
                    <div class="text-center p-6 bg-gray-800 rounded-lg w-full md:w-1/3 border border-green-500/30">
                        <span class="text-5xl">🐂</span>
                        <h3 class="text-xl font-semibold mt-2 text-green-400">Compradores (Toros)</h3>
                        <p class="mt-2 text-gray-300">Empujan el precio hacia arriba, creando una serie de mínimos cada vez más altos.</p>
                    </div>
                    <div class="text-3xl font-bold text-gray-500">VS</div>
                    <div class="text-center p-6 bg-gray-800 rounded-lg w-full md:w-1/3 border border-red-500/30">
                        <span class="text-5xl">🐻</span>
                        <h3 class="text-xl font-semibold mt-2 text-red-400">Vendedores (Osos)</h3>
                        <p class="mt-2 text-gray-300">Presionan el precio a la baja, generando una serie de máximos cada vez más bajos.</p>
                    </div>
                </div>
                <p class="mt-6 text-center max-w-2xl mx-auto text-gray-300">Esta indecisión comprime el precio hasta que un lado cede, resultando en una ruptura impulsiva. El volumen decreciente durante la formación confirma esta calma antes de la tormenta.</p>
            </div>
            
            <!-- Section 3: Real Example -->
            <div class="card">
                <h2 class="text-2xl font-bold mb-4 text-white">Ejemplo Real: Índice IPSA de Chile</h2>
                <p class="mb-6 text-gray-400">La teoría cobra vida con este ejemplo real del S&P IPSA. Observa cómo el patrón se formó durante meses y cómo la ruptura cumplió el objetivo de precio proyectado casi a la perfección.</p>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-2 text-gray-300">Gráfico Real del S&P IPSA</h3>
                            <div class="bg-gray-800 rounded-lg border border-gray-700 p-2 aspect-video flex items-center justify-center">
                                 <img src="https://github.com/amolinad22/foco-bursatil-web/blob/main/SP_IPSA_2025-08-28_16-30-13_faaf9.png?raw=true" alt="Gráfico real del S&P IPSA" class="rounded-md w-full h-full object-cover">
                            </div>
                        </div>
                        <div>
                             <h3 class="text-lg font-semibold mb-2 text-gray-300">Gráfico Interactivo (Ilustración)</h3>
                            <div class="h-80">
                                <canvas id="ipsaChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-3 text-indigo-400">Análisis del Caso Real:</h3>
                        <ul class="space-y-4 text-gray-300">
                            <li><strong>Formación:</strong> Entre mayo y principios de agosto, el IPSA se consolidó, formando mínimos ascendentes y máximos descendentes claros.</li>
                            <li><strong>Ruptura (Breakout):</strong> A mediados de agosto, el precio rompió la línea de resistencia superior con una vela de gran cuerpo, señalando la victoria de los compradores.</li>
                            <li><strong>Objetivo Cumplido:</strong> La línea vertical mide la altura de la base del triángulo. Al proyectar esta altura desde el punto de ruptura, se puede ver que el precio alcanzó el objetivo técnico, validando la eficacia del patrón.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Section 4: Trading Simulator -->
            <div class="card">
                <h2 class="text-2xl font-bold mb-4 text-white">Simulador de Trading: Opera el Patrón</h2>
                <p class="mb-6 text-gray-400">Ahora, pongamos la teoría en práctica. Sigue los pasos para simular una operación completa de un triángulo simétrico, desde la identificación hasta la toma de ganancias.</p>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
                     <div class="md:col-span-3">
                         <canvas id="simulatorChart"></canvas>
                    </div>
                    <div class="md:col-span-2">
                        <div id="sim-steps" class="space-y-4">
                            <div class="p-3 bg-gray-800 rounded-lg border border-gray-700">
                                <p><strong>Paso 1: Identificación y Dibujo</strong></p>
                                <p class="text-sm text-gray-400">El patrón está formado. Observa las líneas de tendencia convergentes y el volumen decreciente.</p>
                            </div>
                            <div id="step-2" class="p-3 bg-gray-800 rounded-lg border border-gray-700 opacity-50">
                                <p><strong>Paso 2: Esperar la Ruptura</strong></p>
                                <p class="text-sm text-gray-400 mb-2">La paciencia es clave. No te anticipes. Haz clic para simular una ruptura alcista decisiva.</p>
                                <button id="simulate-breakout" class="btn btn-primary w-full text-sm">Simular Ruptura</button>
                            </div>
                             <div id="step-3" class="p-3 bg-gray-800 rounded-lg border border-gray-700 opacity-50">
                                <p><strong>Paso 3: Estrategia de Entrada</strong></p>
                                <p class="text-sm text-gray-400">La entrada se realiza al cierre de la vela de ruptura. El punto de entrada está marcado en verde.</p>
                            </div>
                            <div id="step-4" class="p-3 bg-gray-800 rounded-lg border border-gray-700 opacity-50">
                                <p><strong>Paso 4: Colocación del Stop-Loss</strong></p>
                                 <p class="text-sm text-gray-400 mb-2">Gestiona el riesgo. Coloca el stop-loss por debajo del último mínimo del patrón.</p>
                                <button id="show-stoploss" class="btn w-full text-sm">Mostrar Stop-Loss</button>
                            </div>
                            <div id="step-5" class="p-3 bg-gray-800 rounded-lg border border-gray-700 opacity-50">
                                <p><strong>Paso 5: Objetivo de Ganancias</strong></p>
                                <p class="text-sm text-gray-400 mb-2">Proyecta la altura de la base del triángulo desde el punto de ruptura para establecer el objetivo.</p>
                                <button id="calculate-target" class="btn w-full text-sm">Calcular Objetivo</button>
                            </div>
                        </div>
                        <button id="reset-simulation" class="mt-4 btn w-full">Reiniciar Simulación</button>
                    </div>
                </div>
            </div>

            <!-- Disclaimer -->
            <div class="text-center text-xs text-gray-500 py-8">
                <p><strong>Disclaimer:</strong> Este contenido es únicamente para fines educativos e informativos. No constituye asesoramiento financiero, de inversión ni de ningún otro tipo. El trading y la inversión en los mercados financieros conllevan un riesgo significativo. Realice siempre su propia investigación y consulte a un profesional financiero calificado antes de tomar cualquier decisión de inversión.</p>
            </div>
        </div>
    </template>
    <template id="template-contacto-page">
        <div class="text-center mb-12"><h1 class="text-4xl font-bold text-white">Contacto</h1><p class="mt-2 text-lg text-gray-400">¿Tienes alguna pregunta o sugerencia? ¡Contáctanos!</p></div>
        <div class="max-w-xl mx-auto bg-[#161B22] border border-gray-700 rounded-xl p-8"><form action="#" method="POST"><div class="space-y-6"><div><label for="name" class="block text-sm font-medium text-gray-300">Nombre</label><div class="mt-1"><input type="text" name="name" id="name" autocomplete="name" class="block w-full bg-gray-800 border-gray-600 rounded-md py-3 px-4 text-white focus:ring-blue-500 focus:border-blue-500"></div></div><div><label for="email" class="block text-sm font-medium text-gray-300">Email</label><div class="mt-1"><input id="email" name="email" type="email" autocomplete="email" class="block w-full bg-gray-800 border-gray-600 rounded-md py-3 px-4 text-white focus:ring-blue-500 focus:border-blue-500"></div></div><div><label for="message" class="block text-sm font-medium text-gray-300">Mensaje</label><div class="mt-1"><textarea id="message" name="message" rows="4" class="block w-full bg-gray-800 border-gray-600 rounded-md py-3 px-4 text-white focus:ring-blue-500 focus:border-blue-500"></textarea></div></div><div><button type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-300">Enviar Mensaje</button></div></div></form></div>
    </template>

    <!-- Image Confirmation Modal -->
    <div id="image-preview-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-8 max-w-lg w-full">
            <h3 class="text-2xl font-semibold text-white mb-4">Confirmar Análisis</h3>
            <div class="mb-6"><img id="modal-image-preview" src="" alt="Vista previa del análisis" class="max-h-96 w-auto mx-auto rounded-lg"></div>
            <div class="flex justify-end gap-4">
                <button id="cancel-upload-btn" class="bg-gray-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-gray-700 transition-colors">Cancelar</button>
                <button id="confirm-upload-btn" class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 transition-colors">Confirmar y Subir</button>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="bg-gray-900 border-t border-gray-700 mt-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-gray-400">
            <p>&copy; 2025 Foco Bursátil. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Element references
            const homePage = document.getElementById('home-page');
            const toolsPageContainer = document.getElementById('tools-page-container');
            const toolsContentContainer = document.getElementById('tools-content-container');
            const homeCardsGrid = document.getElementById('home-cards-grid');
            const homeIconBar = document.getElementById('home-icon-bar');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const closeMobileMenuButton = document.getElementById('close-mobile-menu');
            const mobileNavLinksContainer = document.getElementById('mobile-nav-links');

            // Data for all the tools/sections
            const tools = [
                { id: 'panorama-market-page', title: 'Panorama', description: 'Un vistazo general a los principales mercados y activos.', icon: `<img src="https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?auto=format&fit=crop&q=80&w=200&h=200" alt="Panorama" class="w-full h-full object-cover">` },
                { id: 'analisis-tecnico-page', title: 'Análisis Técnico', description: 'Herramientas visuales para analizar la acción del precio.', icon: `<img src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?auto=format&fit=crop&q=80&w=200&h=200" alt="Análisis Técnico" class="w-full h-full object-cover">` },
                { id: 'chile-market-page', title: 'Chile', description: 'Sigue de cerca el S&P IPSA y las acciones locales.', icon: `<img src="https://flagcdn.com/cl.svg" alt="Bandera de Chile" class="w-full h-full object-contain p-2">` },
                { id: 'usa-market-page', title: 'USA', description: 'Analiza los gigantes de Wall Street con nuestro mapa de calor.', icon: `<img src="https://flagcdn.com/us.svg" alt="Bandera de EE.UU." class="w-full h-full object-contain p-2">` },
                { id: 'crypto-page', title: 'Cryptomonedas', description: 'Explora el mercado de cryptomonedas con nuestro mapa de calor.', icon: `<img src="https://images.unsplash.com/photo-1639322537228-f710d846310a?auto=format&fit=crop&q=80&w=200&h=200" alt="Cryptomonedas" class="w-full h-full object-cover">` },
                { id: 'noticias-page', title: 'Noticias', description: 'Las últimas noticias que mueven los mercados.', icon: `<img src="https://images.unsplash.com/photo-1495020689067-958852a7765e?auto=format&fit=crop&q=80&w=200&h=200" alt="Noticias" class="w-full h-full object-cover">` },
                { id: 'calendario-page', title: 'Calendario', description: 'Anticípate a los eventos económicos clave.', icon: `<img src="https://images.unsplash.com/photo-1506784983877-45594efa4cbe?auto=format&fit=crop&q=80&w=200&h=200" alt="Calendario" class="w-full h-full object-cover">` },
                { id: 'educacion-page', title: 'Educación', description: 'Aprende los conceptos clave para invertir con confianza.', icon: `<img src="https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?auto=format&fit=crop&q=80&w=200&h=200" alt="Educación" class="w-full h-full object-cover">` },
                { id: 'contacto-page', title: 'Contacto', description: '¿Tienes preguntas? Ponte en contacto con nosotros.', icon: `<img src="https://images.unsplash.com/photo-1596526131083-e8c633c948d2?auto=format&fit=crop&q=80&w=200&h=200" alt="Contacto" class="w-full h-full object-cover">` }
            ];

            const loadedWidgets = new Set();
            let currentFileToUpload = null;
            let anatomyChartInstance;
            let simulatorChartInstance;

            // Function to dynamically create the initial UI from the `tools` array
            function createInitialUI() {
                // Create home page cards and mobile nav links
                tools.forEach((tool) => {
                    const card = document.createElement('div');
                    card.className = 'group bg-[#161B22] border border-gray-700 rounded-xl p-8 flex flex-col items-center text-center transform hover:-translate-y-2 transition-all duration-300 hover:border-blue-500 hover:shadow-2xl hover:shadow-blue-500/10';
                    card.innerHTML = `<div class="h-16 w-16 mb-6 rounded-full overflow-hidden transition-all duration-300 group-hover:scale-110 bg-gray-800 flex items-center justify-center">${tool.icon}</div><h3 class="text-xl font-semibold text-white mb-2">${tool.title}</h3><p class="text-gray-400 mb-6 flex-grow">${tool.description}</p><button data-page="${tool.id}" class="home-card-btn w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-300">Ver Sección</button>`;
                    homeCardsGrid.appendChild(card);

                    const mobileLink = document.createElement('a');
                    mobileLink.href = '#';
                    mobileLink.className = 'mobile-nav-link text-gray-300 hover:text-white transition-colors py-2';
                    mobileLink.textContent = tool.title;
                    mobileLink.dataset.page = tool.id;
                    mobileNavLinksContainer.appendChild(mobileLink);
                });

                // Function to create a single ticker icon element
                const createTickerIcon = (tool) => {
                    const iconLink = document.createElement('a');
                    iconLink.href = '#';
                    iconLink.className = 'home-icon-link flex flex-row items-center gap-2 group';
                    iconLink.dataset.page = tool.id;
                    iconLink.innerHTML = `
                        <div class="w-8 h-8 rounded-full overflow-hidden flex items-center justify-center transform group-hover:scale-110 transition-all duration-300 flex-shrink-0 bg-gray-800">
                            ${tool.icon}
                        </div>
                        <span class="text-xs text-gray-400 group-hover:text-white transition-colors whitespace-nowrap">${tool.title}</span>
                    `;
                    return iconLink;
                };

                // Create two sets of icons for a seamless loop
                tools.forEach(tool => homeIconBar.appendChild(createTickerIcon(tool)));
                tools.forEach(tool => homeIconBar.appendChild(createTickerIcon(tool)));
            }

            // Switch view from home page to the tools page
            function showToolsPage(pageId) {
                homePage.classList.add('fade-out');

                setTimeout(() => {
                    homePage.style.display = 'none';
                    homePage.classList.remove('fade-out');
                    
                    toolsPageContainer.style.display = 'block';
                    toolsPageContainer.classList.add('fade-in');
                    showToolContent(pageId);
                }, 300);
            }

            // Display the content for a specific tool
            function showToolContent(pageId) {
                const template = document.getElementById(`template-${pageId}`);
                if (!template) return;

                // Show loader
                toolsContentContainer.innerHTML = `<div class="flex justify-center items-center h-64"><span class="loader"></span></div>`;

                // Simulate loading time for widgets
                setTimeout(() => {
                    if (document.querySelector(`#template-${pageId}`)) {
                        toolsContentContainer.innerHTML = template.innerHTML;
                        loadWidgetsForContent(pageId);
                    }
                }, 500); // 0.5 second delay

                // Update active icon state in the ticker
                document.querySelectorAll('.home-icon-link').forEach(link => {
                    link.classList.toggle('active', link.dataset.page === pageId);
                });

                window.scrollTo(0, 0);
            }

            // Mobile menu controls
            function openMobileMenu() { mobileMenu.classList.remove('translate-x-full'); }
            function closeMobileMenu() { mobileMenu.classList.add('translate-x-full'); }

            // Load TradingView widgets for the current page
            function loadWidgetsForContent(pageId) {
                // Special setup for the education page
                if (pageId === 'educacion-page') {
                    setupImageUpload();
                    setupEducationCharts();
                }

                const widgetContainers = toolsContentContainer.querySelectorAll('.tradingview-widget-container__widget');
                widgetContainers.forEach(container => {
                    const widgetType = container.dataset.widgetType;
                    const widgetKey = `${pageId}-${widgetType}`;

                    // Avoid reloading widgets that are already loaded
                    if (loadedWidgets.has(widgetKey)) return;

                    let config = {};
                    let scriptSrc = '';

                    // Configuration for each widget type
                    switch(widgetType) {
                        case 'market-overview':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js';
                            config = { "colorTheme": "dark", "dateRange": "12M", "locale": "es", "largeChartUrl": "", "isTransparent": false, "showFloatingTooltip": true, "plotLineColorGrowing": "rgba(41, 98, 255, 1)", "plotLineColorFalling": "rgba(41, 98, 255, 1)", "gridLineColor": "rgba(240, 243, 250, 0)", "scaleFontColor": "#DBDBDB", "belowLineFillColorGrowing": "rgba(41, 98, 255, 0.12)", "belowLineFillColorFalling": "rgba(41, 98, 255, 0.12)", "belowLineFillColorGrowingBottom": "rgba(41, 98, 255, 0)", "belowLineFillColorFallingBottom": "rgba(41, 98, 255, 0)", "symbolActiveColor": "rgba(41, 98, 255, 0.12)", "tabs": [ { "title": "INDICES", "symbols": [ {"s": "CAPITALCOM:US500", "d": "S&P 500"}, {"s": "CAPITALCOM:US100", "d": "NASDAQ 100"}, {"s": "CAPITALCOM:US30", "d": "DOW JONES 30"}, {"s": "XETR:DAX", "d": "DAX"}, {"s": "BCS:SP_IPSA", "d": "IPSA"}, {"s": "BMFBOVESPA:IBOV", "d": "BOVESPA"}, {"s": "BCBA:IMV", "d": "MERVAL"} ], "originalTitle": "Indices" }, { "title": "COMMODITIES", "symbols": [ {"s": "CMCMARKETS:GOLD", "d": "ORO"}, {"s": "PYTH:WTI3!", "d": "PETROLEO"}, {"s": "CAPITALCOM:COPPER", "d": "COBRE"}, {"s": "CAPITALCOM:SILVER", "d": "PLATA"}, {"s": "CAPITALCOM:NATURALGAS", "d": "GAS NATURAL"} ], "originalTitle": "Futures" }, { "title": "DIVISAS", "symbols": [ {"s": "FX_IDC:USDCLP", "d": "USDCLP"}, {"s": "FX:EURUSD", "d": "EURUSD"}, {"s": "FX:USDJPY", "d": "USDJPY"}, {"s": "FX:GBPUSD", "d": "GBPUSD"}, {"s": "FX:USDCHF", "d": "USDCHF"} ], "originalTitle": "Forex" }, { "title": "CRYPTOMONEDAS", "symbols": [ {"s": "COINBASE:BTCUSD", "d": "BTCUSD"}, {"s": "COINBASE:ETHUSD", "d": "ETHUSD"}, {"s": "COINBASE:XRPUSD", "d": "XRPUSD"}, {"s": "COINBASE:SOLUSD", "d": "SOLUSD"}, {"s": "COINBASE:ATOMUSD", "d": "ATOMUSD"}, {"s": "CRYPTOCAP:TOTAL", "d": "Crypto Total Market Cap"} ] } ], "width": "100%", "height": "100%", "showSymbolLogo": true, "showChart": true };
                            break;
                        case 'advanced-chart':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js';
                            config = { "autosize": true, "symbol": "BCS:SP_IPSA", "interval": "D", "timezone": "America/Santiago", "theme": "dark", "style": "1", "locale": "es", "allow_symbol_change": true, "calendar": true, "details": true, "hotlist": true, "hide_side_toolbar": false, "studies": ["Volume@tv-basicstudies", "RSI@tv-basicstudies"] };
                            break;
                        case 'heatmap-cl':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-stock-heatmap.js';
                            config = { "dataSource": "BCSSPIPSA", "blockSize": "market_cap_basic", "blockColor": "change", "grouping": "sector", "locale": "es", "symbolUrl": "", "colorTheme": "dark", "exchanges": [], "hasTopBar": true, "isDataSetEnabled": true, "isZoomEnabled": true, "hasSymbolTooltip": true, "isMonoSize": false, "width": "100%", "height": "100%" };
                            break;
                        case 'hotlists-cl':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-hotlists.js';
                            config = { "exchange": "BCS", "colorTheme": "dark", "dateRange": "12M", "showChart": true, "locale": "es", "isTransparent": true, "width": "100%", "height": "100%" };
                            break;
                        case 'heatmap-us':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-stock-heatmap.js';
                            config = { "dataSource": "SPX500", "blockSize": "market_cap_basic", "blockColor": "change", "grouping": "sector", "locale": "es", "symbolUrl": "", "colorTheme": "dark", "exchanges": [], "hasTopBar": true, "isDataSetEnabled": true, "isZoomEnabled": true, "hasSymbolTooltip": true, "isMonoSize": false, "width": "100%", "height": "100%" };
                            break;
                        case 'hotlists-us':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-hotlists.js';
                            config = { "exchange": "US", "colorTheme": "dark", "dateRange": "12M", "showChart": true, "locale": "es", "isTransparent": true, "width": "100%", "height": "100%" };
                            break;
                        case 'timeline':
                             scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-timeline.js';
                             config = { "feedMode": "all_symbols", "colorTheme": "dark", "isTransparent": true, "displayMode": "regular", "width": "100%", "height": "100%", "locale": "es" };
                             break;
                        case 'economic-calendar':
                             scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-events.js';
                             config = { "colorTheme": "dark", "isTransparent": false, "locale": "es", "countryFilter": "", "importanceFilter": "0,1", "width": "100%", "height": "100%" };
                             break;
                        case 'crypto-coins-heatmap':
                             scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-crypto-coins-heatmap.js';
                             config = { "dataSource": "Crypto", "blockSize": "market_cap_calc", "blockColor": "24h_close_change|5", "locale": "es", "symbolUrl": "", "colorTheme": "dark", "hasTopBar": true, "isDataSetEnabled": true, "isZoomEnabled": true, "hasSymbolTooltip": true, "isMonoSize": false, "width": "100%", "height": "100%" };
                             break;
                        case 'crypto-screener':
                             scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-screener.js';
                             config = { "defaultColumn": "overview", "screener_type": "crypto_mkt", "displayCurrency": "USD", "colorTheme": "dark", "isTransparent": false, "locale": "es", "width": "100%", "height": "100%" };
                             break;
                    }
                    
                    // Dynamically create and append the widget script
                    const script = document.createElement('script');
                    script.src = scriptSrc;
                    script.async = true;
                    script.innerHTML = JSON.stringify(config);
                    container.innerHTML = ''; // Clear container before adding the script
                    container.appendChild(script);
                    loadedWidgets.add(widgetKey);
                });
            }

            // --- Enhanced image upload functionality with localStorage persistence ---
            function setupImageUpload() {
                const uploadInput = document.getElementById('analysis-upload');
                const gallery = document.getElementById('analysis-gallery');
                const modal = document.getElementById('image-preview-modal');
                const modalImage = document.getElementById('modal-image-preview');
                const confirmBtn = document.getElementById('confirm-upload-btn');
                const cancelBtn = document.getElementById('cancel-upload-btn');

                if (!uploadInput || !gallery || !modal) return;

                const STORAGE_KEY = 'focoBursatil_galleryImages';

                // Renders a single image card in the gallery
                function renderImageCard(imageData) {
                    const card = document.createElement('div');
                    card.className = 'relative group bg-gray-800 rounded-lg overflow-hidden';
                    
                    const img = document.createElement('img');
                    img.src = imageData;
                    img.className = 'w-full h-auto object-cover';
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'absolute top-2 right-2 bg-red-600 text-white rounded-full p-1.5 opacity-0 group-hover:opacity-100 transition-opacity';
                    deleteBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>`;
                    
                    deleteBtn.onclick = () => {
                        // Remove image from localStorage
                        const storedImages = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                        const updatedImages = storedImages.filter(url => url !== imageData);
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(updatedImages));
                        // Remove image from the DOM
                        card.remove();
                    };
                    
                    card.appendChild(img);
                    card.appendChild(deleteBtn);
                    gallery.appendChild(card);
                }

                // Loads all saved images from localStorage on page load
                function loadImagesFromStorage() {
                    const storedImages = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                    gallery.innerHTML = ''; // Clear gallery before loading
                    storedImages.forEach(imageData => renderImageCard(imageData));
                }

                // Event listener for the file input
                uploadInput.addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (file && file.type.startsWith('image/')){
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            currentFileToUpload = e.target.result;
                            modalImage.src = currentFileToUpload;
                            modal.classList.remove('hidden');
                        };
                        reader.readAsDataURL(file);
                    }
                });

                // Closes the confirmation modal and resets state
                function closeModal() {
                    modal.classList.add('hidden');
                    modalImage.src = "";
                    currentFileToUpload = null;
                    uploadInput.value = ""; // Allows re-selecting the same file
                }

                // Confirms upload, saves to localStorage, and renders the image
                confirmBtn.addEventListener('click', () => {
                    if (currentFileToUpload) {
                        const storedImages = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                        // Add to storage if it's not already there
                        if (!storedImages.includes(currentFileToUpload)) {
                            storedImages.push(currentFileToUpload);
                            localStorage.setItem(STORAGE_KEY, JSON.stringify(storedImages));
                            renderImageCard(currentFileToUpload);
                        }
                    }
                    closeModal();
                });

                cancelBtn.addEventListener('click', closeModal);

                // Initial load of images when the function is called
                loadImagesFromStorage();
            }
            
            // --- Education Module Script ---
            function setupEducationCharts() {
                const anatomyData = {
                    info: {
                        lines: {
                            title: 'Líneas de Tendencia Convergentes',
                            text: 'El patrón se define por dos líneas de tendencia que se mueven una hacia la otra. La línea superior (resistencia) conecta los máximos decrecientes, mientras que la línea inferior (soporte) conecta los mínimos crecientes.'
                        },
                        points: {
                            title: 'Puntos de Contacto',
                            text: 'Para que el patrón sea válido, cada línea de tendencia debe ser tocada al menos dos veces. Estos puntos de contacto validan las zonas de soporte y resistencia que están comprimiendo el precio.'
                        },
                        volume: {
                            title: 'Volumen Decreciente',
                            text: 'Una característica clave es la disminución del volumen de negociación a medida que el patrón se desarrolla. Esto indica que tanto compradores como vendedores están perdiendo convicción, esperando una señal clara antes de comprometerse.'
                        },
                        breakout: {
                            title: 'La Ruptura (Breakout)',
                            text: 'La ruptura ocurre cuando el precio se mueve decisivamente por encima de la línea de resistencia o por debajo de la línea de soporte, usualmente acompañado de un aumento significativo en el volumen. Esto señala el fin de la consolidación.'
                        }
                    }
                };

                const simulatorData = {
                    initialPrice: [50, 55, 51, 54.5, 51.5, 54, 52],
                    initialVolume: [200, 180, 160, 140, 120, 100, 80],
                    breakoutPrice: [53.5, 58],
                    breakoutVolume: [250, 220]
                };
                
                const anatomyCtx = document.getElementById('anatomyChart').getContext('2d');
                const anatomyLabels = Array.from({ length: 25 }, (_, i) => i + 1);
                const anatomyPriceData = [100, 105, 102, 108, 104, 110, 106, 111, 108, 110, 108.5, 109.5, 108.8, 109.2, 109, 109.1, 109.05, 109.08, 109.06, 109.07, 112, 111, 114, 113, 115];
                const anatomyVolumeData = [150, 180, 160, 200, 170, 220, 180, 230, 190, 150, 140, 130, 120, 110, 100, 90, 80, 70, 60, 50, 250, 220, 280, 240, 300];

                anatomyChartInstance = new Chart(anatomyCtx, {
                    type: 'line',
                    data: {
                        labels: anatomyLabels,
                        datasets: [
                            {
                                label: 'Precio',
                                data: anatomyPriceData,
                                borderColor: '#60a5fa',
                                backgroundColor: 'rgba(96, 165, 250, 0.1)',
                                fill: true,
                                tension: 0.1,
                                yAxisID: 'y',
                            },
                            {
                                label: 'Volumen',
                                data: anatomyVolumeData,
                                type: 'bar',
                                backgroundColor: '#4b5563',
                                yAxisID: 'y1',
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: false }
                        },
                        scales: {
                            x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#9ca3af', display: false } },
                            y: { 
                                position: 'left', 
                                grid: { color: 'rgba(255, 255, 255, 0.1)' }, 
                                ticks: { color: '#9ca3af' },
                                min: 98,
                                max: 116 
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: { drawOnChartArea: false },
                                ticks: { display: false }
                            }
                        }
                    }
                });

                const anatomyButtons = document.getElementById('anatomy-buttons');
                const anatomyDescriptionEl = document.getElementById('anatomy-description');
                
                anatomyButtons.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON' && !e.target.classList.contains('active')) {
                        const component = e.target.dataset.component;
                        
                        anatomyButtons.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                        e.target.classList.add('active');

                        const desc = anatomyData.info[component];
                        anatomyDescriptionEl.classList.add('fade-out');

                        setTimeout(() => {
                            anatomyDescriptionEl.innerHTML = `<h3 class="font-bold text-white mb-2">${desc.title}</h3><p class="text-gray-300 text-sm">${desc.text}</p>`;
                            anatomyDescriptionEl.classList.remove('fade-out');
                        }, 300);
                    }
                });

                const ipsaCtx = document.getElementById('ipsaChart').getContext('2d');
                new Chart(ipsaCtx, {
                    type: 'line',
                    data: {
                        labels: ['May', '', 'Jun', '', 'Jul', '', 'Ago', '', 'Sep', ''],
                        datasets: [{
                            label: 'IPSA',
                            data: [5200, 5350, 5150, 5280, 5100, 5200, 5150, 5450, 5350, 5500],
                            borderColor: '#60a5fa',
                            tension: 0.1,
                            pointRadius: 0,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: false }
                        },
                        scales: {
                            x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#9ca3af' } },
                            y: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#9ca3af' } }
                        }
                    }
                });
                
                const simulatorCtx = document.getElementById('simulatorChart').getContext('2d');
                let simState = {};

                function createSimulatorChart() {
                    if (simulatorChartInstance) {
                        simulatorChartInstance.destroy();
                    }
                    simulatorChartInstance = new Chart(simulatorCtx, {
                        type: 'line',
                        data: {
                            labels: [...simulatorData.initialPrice.map((_, i) => `T${i+1}`)],
                            datasets: [
                                {
                                    label: 'Precio',
                                    data: [...simulatorData.initialPrice],
                                    borderColor: '#60a5fa',
                                    tension: 0.1,
                                    yAxisID: 'y',
                                },
                                {
                                    label: 'Volumen',
                                    data: [...simulatorData.initialVolume],
                                    type: 'bar',
                                    backgroundColor: '#4b5563',
                                    yAxisID: 'y1',
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#9ca3af', display: false } },
                                y: { position: 'left', grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#9ca3af' } },
                                y1: { type: 'linear', display: true, position: 'right', grid: { drawOnChartArea: false }, ticks: { display: false } }
                            },
                             plugins: {
                                legend: { display: false },
                            }
                        }
                    });
                }
                
                function resetSimulation() {
                    simState = { breakout: false, stoploss: false, target: false };
                    createSimulatorChart();
                    document.getElementById('step-2').classList.add('opacity-50');
                    document.getElementById('step-3').classList.add('opacity-50');
                    document.getElementById('step-4').classList.add('opacity-50');
                    document.getElementById('step-5').classList.add('opacity-50');
                    document.getElementById('simulate-breakout').disabled = false;
                    document.getElementById('show-stoploss').disabled = true;
                    document.getElementById('calculate-target').disabled = true;
                }

                document.getElementById('simulate-breakout').addEventListener('click', () => {
                    if (simState.breakout) return;
                    simState.breakout = true;
                    
                    simulatorChartInstance.data.labels.push('T16', 'T17');
                    simulatorChartInstance.data.datasets[0].data.push(...simulatorData.breakoutPrice);
                    simulatorChartInstance.data.datasets[1].data.push(...simulatorData.breakoutVolume);
                    simulatorChartInstance.update();
                    
                    document.getElementById('step-2').classList.remove('opacity-50');
                    document.getElementById('step-3').classList.remove('opacity-50');
                    document.getElementById('step-4').classList.remove('opacity-50');
                    document.getElementById('simulate-breakout').disabled = true;
                    document.getElementById('show-stoploss').disabled = false;
                });

                document.getElementById('show-stoploss').addEventListener('click', () => {
                     if (!simState.breakout || simState.stoploss) return;
                     simState.stoploss = true;
                     document.getElementById('step-5').classList.remove('opacity-50');
                     document.getElementById('show-stoploss').disabled = true;
                     document.getElementById('calculate-target').disabled = false;
                });

                document.getElementById('calculate-target').addEventListener('click', () => {
                    if (!simState.stoploss || simState.target) return;
                    simState.target = true;
                    document.getElementById('calculate-target').disabled = true;
                });

                document.getElementById('reset-simulation').addEventListener('click', resetSimulation);
                
                resetSimulation();
            }

            // --- Initialization and Event Listeners ---
            createInitialUI();

            // Function to handle returning to home page
            function returnToHome() {
                toolsPageContainer.classList.add('fade-out');
                
                setTimeout(() => {
                    toolsPageContainer.style.display = 'none';
                    toolsPageContainer.classList.remove('fade-out');

                    homePage.style.display = 'block';
                    homePage.classList.add('fade-in');
                    document.querySelectorAll('.home-icon-link').forEach(link => {
                        link.classList.remove('active');
                    });
                }, 300);

                window.scrollTo(0, 0);
            }

            // Use event delegation for click handling
            document.body.addEventListener('click', (e) => {
                const target = e.target.closest('.home-card-btn, .mobile-nav-link, .home-icon-link');
                if (target) {
                    e.preventDefault();
                    const pageId = target.dataset.page;
                    showToolsPage(pageId);
                    closeMobileMenu();
                }
            });

            // Logo click listener to return to the home page
            document.getElementById('logo-link').addEventListener('click', (e) => {
                e.preventDefault();
                returnToHome();
            });
            
            // Mobile menu button listeners
            mobileMenuButton.addEventListener('click', openMobileMenu);
            closeMobileMenuButton.addEventListener('click', closeMobileMenu);

            // --- Animated Particle Background Script ---
            const canvas = document.getElementById('particle-canvas');
            const ctx = canvas.getContext('2d');
            let particles = [];

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }

            function createParticles() {
                particles = [];
                let numberOfParticles = (canvas.height * canvas.width) / 9000;
                for(let i = 0; i < numberOfParticles; i++) {
                    particles.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        vx: Math.random() * 0.5 - 0.25,
                        vy: Math.random() * 0.5 - 0.25,
                        radius: Math.random() * 1.5
                    });
                }
            }

            function drawParticles() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                particles.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    ctx.fill();
                });
            }

            function updateParticles() {
                particles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;

                    if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
                });
            }

            function animate() {
                drawParticles();
                updateParticles();
                requestAnimationFrame(animate);
            }

            window.addEventListener('resize', () => {
                resizeCanvas();
                createParticles();
            });

            resizeCanvas();
            createParticles();
            animate();
        });
    </script>
</body>
</html>

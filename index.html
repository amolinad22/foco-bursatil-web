<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foco Burs치til - Herramientas Financieras</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0/dist/chartjs-plugin-annotation.min.js"></script>

    <style>
        /* Custom styles for the application */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0D1117;
        }
        #particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .tradingview-widget-container__widget {
            height: 100%;
            width: 100%;
        }
        #mobile-menu {
            transition: transform 0.3s ease-in-out;
        }
        
        /* --- Integrated Icon Ticker Styles --- */
        .icon-ticker-wrapper {
            flex-grow: 1;
            overflow: hidden;
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        }

        #home-icon-bar {
            display: flex;
            width: max-content;
            animation: scroll 80s linear infinite;
        }

        #home-icon-bar:hover {
            animation-play-state: paused;
        }

        @keyframes scroll {
            from { transform: translateX(0); }
            to { transform: translateX(-50%); }
        }

        .home-icon-link {
            flex-shrink: 0;
            margin: 0 1.5rem;
        }

        /* --- Active Icon State --- */
        .home-icon-link.active > div {
            border-color: #3B82F6;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }
        .home-icon-link.active > span {
            color: #F9FAFB;
        }

        /* --- Loading Spinner Styles --- */
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #FFF;
            border-bottom-color: #3B82F6;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- Page Transition Styles --- */
        .page {
            transition: opacity 0.3s ease-in-out;
        }
        .page.fade-out { opacity: 0; }
        .page.fade-in { opacity: 1; }

        /* --- Education Module Styles --- */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 40vh;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .btn {
            background-color: #374151;
            color: #d1d5db;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            border: 1px solid #4b5563;
        }
        .btn:hover, .btn.active {
            background-color: #4f46e5;
            color: #ffffff;
            border-color: #4f46e5;
        }
        .btn-primary {
            background-color: #4f46e5;
            color: #ffffff;
            font-weight: 600;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        h1, h2, h3 {
            color: #ffffff;
            font-weight: 700;
        }
        #anatomy-description {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        #anatomy-description.fade-out {
            opacity: 0;
            transform: translateY(10px);
        }
        .card {
            background-color: #1f2937;
            border: 1px solid #374151;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body class="text-gray-200">

    <canvas id="particle-canvas"></canvas>

    <!-- Stock Ticker Tape -->
    <div class="tradingview-widget-container">
      <div class="tradingview-widget-container__widget"></div>
      <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
      { "symbols": [ { "proName": "FOREXCOM:SPXUSD", "title": "S&P 500" }, { "proName": "FOREXCOM:NSXUSD", "title": "US 100" }, { "proName": "BITSTAMP:BTCUSD", "title": "Bitcoin" }, { "proName": "BITSTAMP:ETHUSD", "title": "Ethereum" }, { "proName": "BCS:SP_IPSA", "title": "IPSA" }, { "proName": "BCS:SQM_B", "title": "SQM-B" }, { "proName": "BCS:COPEC", "title": "COPEC" }, { "proName": "FX_IDC:USDCLP", "title": "USD/CLP" } ], "colorTheme": "dark", "locale": "es", "isTransparent": false, "showSymbolLogo": true, "displayMode": "adaptive" }
      </script>
    </div>

    <!-- Main Navigation Bar -->
    <header class="bg-gray-900/80 backdrop-blur-sm sticky top-0 z-40 border-b border-gray-700">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <a href="#" id="logo-link" class="text-xl font-bold text-white flex-shrink-0 pr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                </a>
                <div class="icon-ticker-wrapper">
                    <div id="home-icon-bar"></div>
                </div>
                <div class="md:hidden flex-shrink-0 pl-4">
                    <button id="mobile-menu-button" class="text-gray-300 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Menu (Sidebar) -->
    <div id="mobile-menu" class="fixed top-0 right-0 h-full w-64 bg-gray-900 z-50 transform translate-x-full md:hidden p-6 border-l border-gray-700">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-lg font-semibold text-white">Men칰</h2>
            <button id="close-mobile-menu" class="text-gray-400 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <nav id="mobile-nav-links" class="flex flex-col space-y-4"></nav>
    </div>

    <!-- Home Page with Cards -->
    <main id="home-page" class="page container mx-auto px-4 sm:px-6 lg:px-8 py-16 sm:py-24">
        <div class="text-center mb-16">
            <div class="flex justify-center items-center gap-4 sm:gap-8">
                <div class="text-right">
                    <h1 class="text-4xl sm:text-5xl font-bold text-white tracking-tight">El Pulso del Mercado</h1>
                    <p class="mt-2 text-base sm:text-lg text-gray-400">Todas las herramientas que necesitas, en un solo lugar.</p>
                </div>
                <img src="https://github.com/amolinad22/foco-bursatil-web/blob/main/logo%20redondo%202.png?raw=true" alt="Foco Burs치til Logo" class="h-36 sm:h-56 w-auto flex-shrink-0" onerror="this.onerror=null;this.src='https://placehold.co/150x50/0D1117/FFFFFF?text=Logo';">
            </div>
        </div>
        <div id="home-cards-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 relative z-10"></div>
    </main>

    <!-- Tools Container -->
    <main id="tools-page-container" class="page container mx-auto px-4 sm:px-6 lg:px-8 py-12" style="display: none;">
        <div id="tools-content-container"></div>
    </main>

    <!-- Content Templates for Tools -->
    <template id="template-panorama-market-page">
        <div class="text-center mb-12"><h1 class="text-4xl font-bold text-white">Panorama del Mercado</h1><p class="mt-2 text-lg text-gray-400">Un vistazo general a los principales mercados.</p></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8"><div class="w-full h-[650px]"><div class="tradingview-widget-container__widget" data-widget-type="market-overview"></div></div></div>
    </template>
    <template id="template-analisis-tecnico-page">
        <div class="text-center mb-12"><h1 class="text-4xl font-bold text-white">An치lisis T칠cnico</h1><p class="mt-2 text-lg text-gray-400">Gr치fico avanzado para analizar tus activos favoritos.</p></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-4"><div class="h-[75vh]"><div class="tradingview-widget-container__widget" data-widget-type="advanced-chart"></div></div></div>
    </template>
    <template id="template-chile-market-page">
        <div class="text-center mb-12">
            <div class="inline-flex items-center justify-center">
                <img src="https://flagcdn.com/cl.svg" width="40" alt="Bandera de Chile" class="mr-4">
                <h1 class="text-4xl font-bold text-white">Chile</h1>
            </div>
            <p class="mt-2 text-lg text-gray-400">Mapa de Calor y an치lisis de las acciones chilenas.</p>
            <p class="mt-2 text-sm text-gray-500 italic">La informaci칩n de mercado presenta un desfase de 20 minutos.</p>
        </div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8 mb-12"><div class="h-[700px]"><div class="tradingview-widget-container__widget" data-widget-type="heatmap-cl"></div></div></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8"><h2 class="text-2xl font-semibold text-white mb-4 text-center">Acciones M치s Activas</h2><div class="h-[550px]"><div class="tradingview-widget-container__widget" data-widget-type="hotlists-cl"></div></div></div>
    </template>
    <template id="template-usa-market-page">
        <div class="text-center mb-12"><div class="inline-flex items-center justify-center"><img src="https://flagcdn.com/us.svg" width="40" alt="Bandera de EE.UU." class="mr-4"><h1 class="text-4xl font-bold text-white">USA</h1></div><p class="mt-2 text-lg text-gray-400">Mapa de Calor del S&P 500 y las acciones m치s activas.</p></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8 mb-12"><div class="h-[700px]"><div class="tradingview-widget-container__widget" data-widget-type="heatmap-us"></div></div></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8"><h2 class="text-2xl font-semibold text-white mb-4 text-center">Acciones M치s Activas</h2><div class="h-[550px]"><div class="tradingview-widget-container__widget" data-widget-type="hotlists-us"></div></div></div>
    </template>
    <template id="template-crypto-page">
        <div class="text-center mb-12"><h1 class="text-4xl font-bold text-white">Mercado de Cryptomonedas</h1><p class="mt-2 text-lg text-gray-400">Visualiza el rendimiento con nuestro mapa de calor y screener.</p></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8 mb-12"><div class="h-[700px]"><div class="tradingview-widget-container__widget" data-widget-type="crypto-coins-heatmap"></div></div></div>
        <div class="text-center mb-12"><h2 class="text-3xl font-bold text-white">Screener de Cryptomonedas</h2><p class="mt-2 text-lg text-gray-400">Filtra y encuentra cryptomonedas seg칰n tus criterios.</p></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8"><div class="h-[80vh]"><div class="tradingview-widget-container__widget" data-widget-type="crypto-screener"></div></div></div>
    </template>
    <template id="template-noticias-page">
        <div class="text-center mb-12"><h1 class="text-4xl font-bold text-white">Noticias del Mercado</h1><p class="mt-2 text-lg text-gray-400">Las 칰ltimas noticias que mueven los mercados.</p></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-6 md:p-8"><div class="h-[80vh]"><div class="tradingview-widget-container__widget" data-widget-type="timeline"></div></div></div>
    </template>
    <template id="template-calendario-page">
        <div class="text-center mb-12"><h1 class="text-4xl font-bold text-white">Calendario Econ칩mico</h1><p class="mt-2 text-lg text-gray-400">Antic칤pate a los eventos clave.</p></div>
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-2 md:p-4"><div class="h-[80vh]"><div class="tradingview-widget-container__widget" data-widget-type="economic-calendar"></div></div></div>
    </template>
    <template id="template-educacion-page">
        <div class="text-gray-300">
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-bold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-purple-500">Patrones de An치lisis T칠cnico</h1>
                <p class="text-lg text-gray-400 max-w-3xl mx-auto">Explora gu칤as interactivas para entender y operar los patrones de consolidaci칩n y niveles de retroceso m치s comunes.</p>
            </div>

            <!-- Education Sub-Navigation -->
            <div class="flex justify-center mb-8 space-x-4">
                <button id="show-triangle-study" class="btn active">Tri치ngulo Sim칠trico</button>
                <button id="show-fibonacci-study" class="btn">Retroceso de Fibonacci</button>
            </div>

            <!-- Content for Symmetric Triangle Study -->
            <div id="symmetric-triangle-study" class="study-content">
                <!-- Section 1: Anatomy of the Pattern -->
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-white">Anatom칤a del Patr칩n</h2>
                    <p class="mb-6 text-gray-400">Esta secci칩n desglosa los componentes clave de un tri치ngulo sim칠trico. Haz clic en cada bot칩n para resaltar y entender las diferentes partes del patr칩n en el gr치fico interactivo.</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-2 chart-container h-80">
                            <canvas id="anatomyChart"></canvas>
                        </div>
                        <div>
                            <div id="anatomy-buttons" class="flex flex-wrap gap-2 mb-4">
                                <button class="btn" data-component="lines">L칤neas Convergentes</button>
                                <button class="btn" data-component="points">Puntos de Contacto</button>
                                <button class="btn" data-component="volume">Volumen Decreciente</button>
                                <button class="btn" data-component="breakout">La Ruptura (Breakout)</button>
                            </div>
                            <div id="anatomy-description" class="p-4 bg-gray-800 rounded-lg min-h-[150px] border border-gray-700">
                                <p class="text-gray-300">Selecciona un componente para ver su descripci칩n aqu칤.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Market Psychology -->
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-white">La Psicolog칤a del Mercado</h2>
                    <p class="mb-6 text-gray-400">El tri치ngulo sim칠trico es m치s que una simple forma en un gr치fico; representa una batalla temporalmente equilibrada entre las fuerzas de la oferta y la demanda.</p>
                    <div class="flex flex-col md:flex-row items-center justify-center gap-8">
                        <div class="text-center p-6 bg-gray-800 rounded-lg w-full md:w-1/3 border border-green-500/30">
                            <span class="text-5xl">游낵</span>
                            <h3 class="text-xl font-semibold mt-2 text-green-400">Compradores (Toros)</h3>
                            <p class="mt-2 text-gray-300">Empujan el precio hacia arriba, creando una serie de m칤nimos cada vez m치s altos.</p>
                        </div>
                        <div class="text-3xl font-bold text-gray-500">VS</div>
                        <div class="text-center p-6 bg-gray-800 rounded-lg w-full md:w-1/3 border border-red-500/30">
                            <span class="text-5xl">游냩</span>
                            <h3 class="text-xl font-semibold mt-2 text-red-400">Vendedores (Osos)</h3>
                            <p class="mt-2 text-gray-300">Presionan el precio a la baja, generando una serie de m치ximos cada vez m치s bajos.</p>
                        </div>
                    </div>
                    <p class="mt-6 text-center max-w-2xl mx-auto text-gray-300">Esta indecisi칩n comprime el precio hasta que un lado cede, resultando en una ruptura impulsiva. El volumen decreciente durante la formaci칩n confirma esta calma antes de la tormenta.</p>
                </div>
                
                <!-- Section 3: Real Example for IPSA -->
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-white">Ejemplo del 칈ndice S&P IPSA</h2>
                    <p class="mb-6 text-gray-400">El gr치fico del 칤ndice S&P IPSA muestra una consolidaci칩n perfecta. Puedes ver c칩mo el precio se comprime entre las dos l칤neas de tendencia hasta que finalmente rompe al alza con fuerza.</p>
                    <div class="space-y-6 mb-8">
                        <div>
                            <h3 class="text-lg font-semibold mb-2 text-gray-300">Gr치fico real</h3>
                            <div class="bg-gray-800 rounded-lg border border-gray-700 p-2 aspect-video flex items-center justify-center">
                                <img src="https://github.com/amolinad22/foco-bursatil-web/blob/main/SP_IPSA_2025-08-28_16-30-13_faaf9.png?raw=true" alt="Gr치fico real del S&P IPSA" class="rounded-md w-full h-full object-cover">
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-3 text-indigo-400">An치lisis del Caso Real:</h3>
                        <ul class="space-y-4 text-gray-300">
                            <li><strong>Formaci칩n:</strong> Entre mayo y principios de agosto, el IPSA se consolid칩, formando m칤nimos ascendentes y m치ximos descendentes claros.</li>
                            <li><strong>Ruptura (Breakout):</strong> A mediados de agosto, el precio rompi칩 la l칤nea de resistencia superior con una vela de gran cuerpo, se침alando la victoria de los compradores.</li>
                            <li><strong>Objetivo Cumplido:</strong> La l칤nea vertical mide la altura de la base del tri치ngulo. Al proyectar esta altura desde el punto de ruptura, se puede ver que el precio alcanz칩 el objetivo t칠cnico, validando la eficacia del patr칩n.</li>
                        </ul>
                    </div>
                </div>

                <!-- Section 3: Real Example for Falabella -->
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-white">Ejemplo de Falabella</h2>
                    <p class="mb-6 text-gray-400">La teor칤a cobra vida con este ejemplo real de Falabella. Observa c칩mo la acci칩n se consolid칩 en un patr칩n de tri치ngulo sim칠trico, con el volumen disminuyendo a medida que el patr칩n se formaba.</p>
                    <div class="space-y-6 mb-8">
                        <div>
                            <h3 class="text-lg font-semibold mb-2 text-gray-300">Gr치fico real</h3>
                            <div class="bg-gray-800 rounded-lg border border-gray-700 p-2 aspect-video flex items-center justify-center">
                                <img src="https://github.com/amolinad22/foco-bursatil-web/blob/main/FALABELLA_2025-08-28_22-18-26_c0023.png?raw=true" alt="Gr치fico real de Falabella" class="rounded-md w-full h-full object-cover">
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-3 text-indigo-400">An치lisis del Caso Real:</h3>
                        <ul class="space-y-4 text-gray-300">
                            <li><strong>Formaci칩n:</strong> Entre junio y agosto, Falabella se consolid칩, formando m칤nimos ascendentes y m치ximos descendentes claros.</li>
                            <li><strong>Ruptura (Breakout):</strong> A mediados de agosto, el precio rompi칩 la l칤nea de resistencia superior con una vela de gran cuerpo, se침alando la victoria de los compradores.</li>
                            <li><strong>Objetivo Cumplido:</strong> La l칤nea vertical mide la altura de la base del tri치ngulo. Al proyectar esta altura desde el punto de ruptura, se puede ver que el precio alcanz칩 el objetivo t칠cnico, validando la eficacia del patr칩n.</li>
                        </ul>
                    </div>
                </div>

                <!-- Section 4: Trading Simulator -->
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-white">Simulador de Trading: Opera el Patr칩n</h2>
                    <p class="mb-6 text-gray-400">Ahora, pongamos la teor칤a en pr치ctica. Sigue los pasos para simular una operaci칩n completa de un tri치ngulo sim칠trico, desde la identificaci칩n hasta la toma de ganancias.</p>
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
                        <div class="md:col-span-3 chart-container h-80">
                            <canvas id="simulatorChart"></canvas>
                        </div>
                        <div class="md:col-span-2">
                            <div id="sim-steps" class="space-y-4">
                                <div id="step-1" class="p-3 bg-gray-800 rounded-lg border border-gray-700">
                                    <p><strong>Paso 1: Identificaci칩n y Dibujo</strong></p>
                                    <p class="text-sm text-gray-400">El patr칩n est치 formado. Observa las l칤neas de tendencia convergentes y el volumen decreciente.</p>
                                </div>
                                <div id="step-2" class="p-3 bg-gray-800 rounded-lg border border-gray-700 opacity-50">
                                    <p><strong>Paso 2: Esperar la Ruptura</strong></p>
                                    <p class="text-sm text-gray-400 mb-2">La paciencia es clave. No te anticipes. Haz clic para simular una ruptura alcista decisiva.</p>
                                    <button id="simulate-breakout" class="btn btn-primary w-full text-sm">Simular Ruptura</button>
                                </div>
                                <div id="step-3" class="p-3 bg-gray-800 rounded-lg border border-gray-700 opacity-50">
                                    <p><strong>Paso 3: Estrategia de Entrada</strong></p>
                                    <p class="text-sm text-gray-400">La entrada se realiza al cierre de la vela de ruptura. El punto de entrada est치 marcado en verde.</p>
                                </div>
                                <div id="step-4" class="p-3 bg-gray-800 rounded-lg border border-gray-700 opacity-50">
                                    <p><strong>Paso 4: Colocaci칩n del Stop-Loss</strong></p>
                                    <p class="text-sm text-gray-400 mb-2">Gestiona el riesgo. Coloca el stop-loss por debajo del 칰ltimo m칤nimo del patr칩n.</p>
                                    <button id="show-stoploss" class="btn w-full text-sm">Mostrar Stop-Loss</button>
                                </div>
                                <div id="step-5" class="p-3 bg-gray-800 rounded-lg border border-gray-700 opacity-50">
                                    <p><strong>Paso 5: Objetivo de Ganancias</strong></p>
                                    <p class="text-sm text-gray-400 mb-2">Proyecta la altura de la base del tri치ngulo desde el punto de ruptura para establecer el objetivo.</p>
                                    <button id="calculate-target" class="btn w-full text-sm">Calcular Objetivo</button>
                                </div>
                            </div>
                            <button id="reset-simulation" class="mt-4 btn w-full">Reiniciar Simulaci칩n</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content for Fibonacci Retracement Study -->
            <div id="fibonacci-study" class="study-content hidden">
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-white">Retroceso de Fibonacci: Entendiendo los Niveles de Soporte</h2>
                    <p class="mb-6 text-gray-400">Para trazar correctamente estos niveles, es crucial identificar el m치ximo y el m칤nimo de la tendencia. La pr치ctica m치s com칰n es utilizar **las mechas (wicks) de las velas**, ya que representan los precios m치s extremos alcanzados durante ese periodo, proporcionando la medici칩n m치s precisa del rango completo del movimiento. El cuerpo de la vela, por otro lado, solo muestra la apertura y el cierre, lo que podr칤a resultar en mediciones inexactas.</p>
                    <p class="mb-6 text-gray-400">Los Retrocesos de Fibonacci son una herramienta de an치lisis t칠cnico para predecir posibles 치reas de soporte y resistencia en una tendencia. Se basa en la secuencia matem치tica de Fibonacci. Pese a tener varios niveles, los m치s utilizados y observados por los traders son el **50% y 61.8%**, que a menudo act칰an como zonas de reversi칩n importantes.</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-2 chart-container h-80">
                            <canvas id="fibonacciChart"></canvas>
                        </div>
                        <div>
                            <div id="fibonacci-buttons" class="flex flex-wrap gap-2 mb-4">
                                <button class="btn" data-component="levels">Niveles Clave</button>
                                <button class="btn" data-component="trend">Tendencia Inicial</button>
                                <button class="btn" data-component="retrace">Zona de Retroceso</button>
                            </div>
                            <div id="fibonacci-description" class="p-4 bg-gray-800 rounded-lg min-h-[150px] border border-gray-700">
                                <p class="text-gray-300">Selecciona un componente para ver su descripci칩n aqu칤.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Section 2: Real Example for ENELCHILE -->
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-white">Ejemplo de Caso Real: ENELCHILE</h2>
                    <p class="mb-6 text-gray-400">El gr치fico de la acci칩n ENELCHILE muestra un rally alcista. Despu칠s de este impulso, el precio retrocedi칩 y prob칩 el nivel de **61.8% de Fibonacci**. Es notable c칩mo el precio baj칩 sutilmente por debajo de este nivel clave, lo que se conoce como una "caza de stop-loss" o un movimiento para liquidar 칩rdenes, antes de rebotar con fuerza y continuar su tendencia alcista original.</p>
                    <div class="space-y-6 mb-8">
                        <div>
                            <h3 class="text-lg font-semibold mb-2 text-gray-300">Gr치fico real</h3>
                            <div class="bg-gray-800 rounded-lg border border-gray-700 p-2 aspect-video flex items-center justify-center">
                                <img src="https://github.com/amolinad22/foco-bursatil-web/blob/main/ENELCHILE_2025-08-28_23-11-11_868c1.png?raw=true" alt="Gr치fico real de ENELCHILE" class="rounded-md w-full h-full object-cover">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 3: Real Example for SQM-B -->
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-white">Ejemplo de Caso Real: SQM-B</h2>
                    <p class="mb-6 text-gray-400">En este gr치fico de SQM-B, la acci칩n experiment칩 un fuerte movimiento alcista. Posteriormente, el precio retrocedi칩 y encontr칩 soporte en el nivel de **50% de Fibonacci** antes de reanudar su tendencia principal. Este nivel clave actu칩 como una zona de acumulaci칩n donde los compradores volvieron a tomar el control.</p>
                    <div class="space-y-6 mb-8">
                        <div>
                            <h3 class="text-lg font-semibold mb-2 text-gray-300">Gr치fico real</h3>
                            <div class="bg-gray-800 rounded-lg border border-gray-700 p-2 aspect-video flex items-center justify-center">
                                <img src="https://github.com/amolinad22/foco-bursatil-web/blob/main/SQM_B_2025-08-28_23-27-44_05c71.png?raw=true" alt="Gr치fico real de SQM-B" class="rounded-md w-full h-full object-cover">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Disclaimer -->
            <div class="text-center text-xs text-gray-500 py-8">
                <p><strong>Disclaimer:</strong> Este contenido es 칰nicamente para fines educativos e informativos. No constituye asesoramiento financiero, de inversi칩n ni de ning칰n otro tipo. El trading y la inversi칩n en los mercados financieros conllevan un riesgo significativo. Realice siempre su propia investigaci칩n y consulte a un profesional financiero calificado antes de tomar cualquier decisi칩n de inversi칩n.</p>
            </div>
        </div>
    </template>
    <template id="template-contacto-page">
        <div class="text-center mb-12"><h1 class="text-4xl font-bold text-white">Contacto</h1><p class="mt-2 text-lg text-gray-400">쯊ienes alguna pregunta o sugerencia? 춰Cont치ctanos!</p></div>
        <div class="max-w-xl mx-auto bg-[#161B22] border border-gray-700 rounded-xl p-8"><form action="#" method="POST"><div class="space-y-6"><div><label for="name" class="block text-sm font-medium text-gray-300">Nombre</label><div class="mt-1"><input type="text" name="name" id="name" autocomplete="name" class="block w-full bg-gray-800 border-gray-600 rounded-md py-3 px-4 text-white focus:ring-blue-500 focus:border-blue-500"></div></div><div><label for="email" class="block text-sm font-medium text-gray-300">Email</label><div class="mt-1"><input id="email" name="email" type="email" autocomplete="email" class="block w-full bg-gray-800 border-gray-600 rounded-md py-3 px-4 text-white focus:ring-blue-500 focus:border-blue-500"></div></div><div><label for="message" class="block text-sm font-medium text-gray-300">Mensaje</label><div class="mt-1"><textarea id="message" name="message" rows="4" class="block w-full bg-gray-800 border-gray-600 rounded-md py-3 px-4 text-white focus:ring-blue-500 focus:border-blue-500"></textarea></div></div><div><button type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-300">Enviar Mensaje</button></div></div></form></div>
    </template>

    <!-- Image Confirmation Modal -->
    <div id="image-preview-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-[#161B22] border border-gray-700 rounded-xl p-8 max-w-lg w-full">
            <h3 class="text-2xl font-semibold text-white mb-4">Confirmar An치lisis</h3>
            <div class="mb-6"><img id="modal-image-preview" src="" alt="Vista previa del an치lisis" class="max-h-96 w-auto mx-auto rounded-lg"></div>
            <div class="flex justify-end gap-4">
                <button id="cancel-upload-btn" class="bg-gray-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-gray-700 transition-colors">Cancelar</button>
                <button id="confirm-upload-btn" class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 transition-colors">Confirmar y Subir</button>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="bg-gray-900 border-t border-gray-700 mt-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-gray-400">
            <p>&copy; 2025 Foco Burs치til. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script type="module">
        // Import Firebase modules. These are essential for connecting to the database.
        // The gallery feature has been removed, so these imports are no longer needed.
        // import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        // import { getFirestore, collection, addDoc, onSnapshot, query, deleteDoc, doc, Timestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        // import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // =======================================================================
        // REFACTORING START: Global scope declarations for chart and simulation logic
        // This ensures the functions are defined before they are called.
        // =======================================================================
        let anatomyChartInstance = null;
        let simulatorChartInstance = null;
        let fibonacciChartInstance = null;
        let simState = {};

        // Reusable chart options
        const chartDefaultOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: { enabled: false }
            },
            scales: {
                x: {
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    ticks: { color: '#9ca3af', display: false }
                },
                y: {
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    ticks: { color: '#9ca3af' }
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    grid: { drawOnChartArea: false },
                    ticks: { display: false }
                }
            }
        };

        // Data and descriptions for Symmetric Triangle Study
        const anatomyDescriptions = {
            lines: {
                title: 'L칤neas de Tendencia Convergentes',
                text: 'El patr칩n se define por dos l칤neas de tendencia que se mueven una hacia la otra. La l칤nea superior (resistencia) conecta los m치ximos decrecientes, mientras que la l칤nea inferior (soporte) conecta los m칤nimos crecientes.',
                annotations: {
                    resistance: {
                        type: 'line', xMin: 1, xMax: 19, yMin: 111.5, yMax: 109.07, borderColor: 'rgb(239, 68, 68)', borderWidth: 2,
                        label: { content: 'Resistencia', enabled: true, position: 'start', backgroundColor: 'rgba(239, 68, 68, 0.7)', color: 'white', font: { size: 10 }, yAdjust: -10 }
                    },
                    support: {
                        type: 'line', xMin: 2, xMax: 18, yMin: 102, yMax: 109.06, borderColor: 'rgb(34, 197, 94)', borderWidth: 2,
                        label: { content: 'Soporte', enabled: true, position: 'start', backgroundColor: 'rgba(34, 197, 94, 0.7)', color: 'white', font: { size: 10 }, yAdjust: 10 }
                    }
                }
            },
            points: {
                title: 'Puntos de Contacto',
                text: 'Para que el patr칩n sea v치lido, cada l칤nea de tendencia debe ser tocada al menos dos veces. Estos puntos de contacto validan las zonas de soporte y resistencia que est치n comprimiendo el precio.',
                annotations: {
                    resistanceLine: { type: 'line', xMin: 1, xMax: 19, yMin: 111.5, yMax: 109.07, borderColor: 'rgba(239, 68, 68, 0.3)', borderWidth: 2 },
                    supportLine: { type: 'line', xMin: 2, xMax: 18, yMin: 102, yMax: 109.06, borderColor: 'rgba(34, 197, 94, 0.3)', borderWidth: 2 },
                    point1: { type: 'point', xValue: 3, yValue: 108, backgroundColor: 'rgb(239, 68, 68)', radius: 6, borderColor: 'white', borderWidth: 2 },
                    point2: { type: 'point', xValue: 5, yValue: 110, backgroundColor: 'rgb(239, 68, 68)', radius: 6, borderColor: 'white', borderWidth: 2 },
                    point3: { type: 'point', xValue: 7, yValue: 111, backgroundColor: 'rgb(239, 68, 68)', radius: 6, borderColor: 'white', borderWidth: 2 },
                    point4: { type: 'point', xValue: 2, yValue: 102, backgroundColor: 'rgb(34, 197, 94)', radius: 6, borderColor: 'white', borderWidth: 2 },
                    point5: { type: 'point', xValue: 4, yValue: 104, backgroundColor: 'rgb(34, 197, 94)', radius: 6, borderColor: 'white', borderWidth: 2 },
                    point6: { type: 'point', xValue: 6, yValue: 106, backgroundColor: 'rgb(34, 197, 94)', radius: 6, borderColor: 'white', borderWidth: 2 },
                }
            },
            volume: {
                title: 'Volumen Decreciente',
                text: 'Una caracter칤stica clave es la disminuci칩n del volumen de negociaci칩n a medida que el patr칩n se desarrolla. Esto indica que tanto compradores como vendedores est치n perdiendo convicci칩n, esperando una se침al clara antes de comprometerse.',
                annotations: {
                    resistanceLine: { type: 'line', xMin: 1, xMax: 19, yMin: 111.5, yMax: 109.07, borderColor: 'rgba(239, 68, 68, 0.3)', borderWidth: 2 },
                    supportLine: { type: 'line', xMin: 2, xMax: 18, yMin: 102, yMax: 109.06, borderColor: 'rgba(34, 197, 94, 0.3)', borderWidth: 2 },
                    volumeTrend: { type: 'line', xMin: 1, xMax: 19, yMin: 230, yMax: 50, borderColor: 'rgb(253, 224, 71)', borderWidth: 2, scaleID: 'y1' }
                }
            },
            breakout: {
                title: 'La Ruptura (Breakout)',
                text: 'La ruptura ocurre cuando el precio se mueve decisivamente por encima de la l칤nea de resistencia o por debajo de la l칤nea de soporte, usualmente acompa침ado de un aumento significativo en el volumen. Esto se침ala el fin de la consolidaci칩n.',
                annotations: {
                    resistanceLine: { type: 'line', xMin: 1, xMax: 19, yMin: 111.5, yMax: 109.07, borderColor: 'rgba(239, 68, 68, 0.3)', borderWidth: 2 },
                    supportLine: { type: 'line', xMin: 2, xMax: 18, yMin: 102, yMax: 109.06, borderColor: 'rgba(34, 197, 94, 0.3)', borderWidth: 2 },
                    breakoutArrow: { type: 'arrow', xMin: 19.5, xMax: 21, yMin: 109.5, yMax: 111.5, end: 'end', borderColor: '#a78bfa', borderWidth: 3 },
                    volumeSpike: { type: 'box', xMin: 19.5, xMax: 20.5, yMin: 0, yMax: 250, scaleID: 'y1', backgroundColor: 'rgba(167, 139, 250, 0.4)' }
                }
            }
        };

        const anatomyLabels = Array.from({ length: 25 }, (_, i) => i + 1);
        const anatomyPriceData = [100, 105, 102, 108, 104, 110, 106, 111, 108, 110, 108.5, 109.5, 108.8, 109.2, 109, 109.1, 109.05, 109.08, 109.06, 109.07, 112, 111, 114, 113, 115];
        const anatomyVolumeData = [150, 180, 160, 200, 170, 220, 180, 230, 190, 150, 140, 130, 120, 110, 100, 90, 80, 70, 60, 50, 250, 220, 280, 240, 300];

        const initialSimData = {
            labels: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
            price: [50, 52, 49, 51.5, 49.5, 51, 50, 50.8, 50.2, 50.7, 50.3, 50.6, 50.4, 50.5, 50.45],
            volume: [100, 120, 90, 110, 80, 95, 70, 80, 65, 70, 60, 65, 55, 60, 50]
        };

        // Data and descriptions for Fibonacci Study
        const fibonacciLevels = [0.0, 0.236, 0.382, 0.5, 0.618, 0.786, 1.0];
        const fibonacciData = {
            labels: Array.from({ length: 30 }, (_, i) => i + 1),
            price: [100, 105, 110, 115, 120, 125, 130, 135, 140, 145, 150, 148, 145, 142, 140, 138, 135, 133, 131, 130, 132, 135, 138, 140, 142, 145, 148, 150, 152, 155],
            high: 150,
            low: 100
        };

        const fibonacciDescriptions = {
            levels: {
                title: 'Niveles Clave de Fibonacci',
                text: 'Los niveles de retroceso m치s utilizados son el 23.6%, 38.2%, 50%, 61.8% y 78.6%. Aunque existen varios niveles, los m치s usados y observados por los traders son el **50% y 61.8%**, que a menudo act칰an como zonas de reversi칩n importantes.',
                annotations: {
                    line1: { type: 'line', yMin: fibonacciData.high, yMax: fibonacciData.high, borderColor: '#7C3AED', borderWidth: 2, label: { content: '100.0% (150)', enabled: true, position: 'start', backgroundColor: 'rgba(0,0,0,0)', color: '#7C3AED', font: { size: 10 }}},
                    line2: { type: 'line', yMin: fibonacciData.high - (fibonacciData.high - fibonacciData.low) * 0.236, yMax: fibonacciData.high - (fibonacciData.high - fibonacciData.low) * 0.236, borderColor: '#60A5FA', borderWidth: 1, label: { content: '23.6% (138.2)', enabled: true, position: 'start', backgroundColor: 'rgba(0,0,0,0)', color: '#60A5FA', font: { size: 10 }}},
                    line3: { type: 'line', yMin: fibonacciData.high - (fibonacciData.high - fibonacciData.low) * 0.382, yMax: fibonacciData.high - (fibonacciData.high - fibonacciData.low) * 0.382, borderColor: '#FCD34D', borderWidth: 1, label: { content: '38.2% (130.9)', enabled: true, position: 'start', backgroundColor: 'rgba(0,0,0,0)', color: '#FCD34D', font: { size: 10 }}},
                    line4: { type: 'line', yMin: fibonacciData.high - (fibonacciData.high - fibonacciData.low) * 0.5, yMax: fibonacciData.high - (fibonacciData.high - fibonacciData.low) * 0.5, borderColor: '#F97316', borderWidth: 2, label: { content: '50.0% (125)', enabled: true, position: 'start', backgroundColor: 'rgba(0,0,0,0)', color: '#F97316', font: { size: 10 }}},
                    line5: { type: 'line', yMin: fibonacciData.high - (fibonacciData.high - fibonacciData.low) * 0.618, yMax: fibonacciData.high - (fibonacciData.high - fibonacciData.low) * 0.618, borderColor: '#F43F5E', borderWidth: 2, label: { content: '61.8% (119.1)', enabled: true, position: 'start', backgroundColor: 'rgba(0,0,0,0)', color: '#F43F5E', font: { size: 10 }}},
                    line6: { type: 'line', yMin: fibonacciData.high - (fibonacciData.high - fibonacciData.low) * 0.786, yMax: fibonacciData.high - (fibonacciData.high - fibonacciData.low) * 0.786, borderColor: '#84CC16', borderWidth: 1, label: { content: '78.6% (110.7)', enabled: true, position: 'start', backgroundColor: 'rgba(0,0,0,0)', color: '#84CC16', font: { size: 10 }}},
                    line7: { type: 'line', yMin: fibonacciData.low, yMax: fibonacciData.low, borderColor: '#7C3AED', borderWidth: 2, label: { content: '0.0% (100)', enabled: true, position: 'start', backgroundColor: 'rgba(0,0,0,0)', color: '#7C3AED', font: { size: 10 }}},
                }
            },
            trend: {
                title: 'Identificaci칩n de la Tendencia Inicial',
                text: 'Para usar los retrocesos de Fibonacci, primero debes identificar un movimiento de precio significativo (impulsivo). En una tendencia alcista, se traza la herramienta desde un m칤nimo hasta un m치ximo. En el gr치fico, se muestra un movimiento inicial desde un m칤nimo de 100 a un m치ximo de 150.',
                annotations: {
                    trendLine: { type: 'line', xMin: 0, xMax: 10, yMin: 100, yMax: 150, borderColor: '#60a5fa', borderWidth: 3 }
                }
            },
            retrace: {
                title: 'La Zona de Retroceso',
                text: 'Una vez que la tendencia inicial termina, el precio a menudo "retrocede" o se mueve en la direcci칩n opuesta. La teor칤a de Fibonacci sugiere que el precio encontrar치 soporte en uno de los niveles clave antes de reanudar la tendencia original. En el gr치fico interactivo, puedes ver el 치rea donde el precio podr칤a rebotar.',
                annotations: {
                    trendLine: { type: 'line', xMin: 0, xMax: 10, yMin: 100, yMax: 150, borderColor: 'rgba(96, 165, 250, 0.3)', borderWidth: 3 },
                    retraceArea: { type: 'box', xMin: 10, xMax: 20, yMin: 119.1, yMax: 130.9, backgroundColor: 'rgba(244, 63, 94, 0.2)', borderColor: 'transparent', label: { content: 'Zona de Retroceso', enabled: true, position: 'start', backgroundColor: 'rgba(0,0,0,0)', color: '#F43F5E', font: { size: 10 } }}
                }
            }
        };

        // Functions to create and manage the charts for each study
        function createAnatomyChart() {
            const anatomyCtx = document.getElementById('anatomyChart');
            if (!anatomyCtx) return;
            const context = anatomyCtx.getContext('2d');
            if (anatomyChartInstance) anatomyChartInstance.destroy();
            anatomyChartInstance = new Chart(context, {
                type: 'line',
                data: {
                    labels: anatomyLabels,
                    datasets: [
                        { label: 'Precio', data: anatomyPriceData, borderColor: '#60a5fa', backgroundColor: 'rgba(96, 165, 250, 0.1)', fill: true, tension: 0.1, yAxisID: 'y' },
                        { label: 'Volumen', data: anatomyVolumeData, type: 'bar', backgroundColor: '#4b5563', yAxisID: 'y1' }
                    ]
                },
                options: {
                    ...chartDefaultOptions,
                    scales: { ...chartDefaultOptions.scales, y: { ...chartDefaultOptions.scales.y, min: 98, max: 116 } },
                    plugins: { ...chartDefaultOptions.plugins, annotation: { annotations: {} } }
                }
            });
        }

        function createSimulatorChart() {
            const simulatorCtx = document.getElementById('simulatorChart');
            if (!simulatorCtx) return;
            const context = simulatorCtx.getContext('2d');
            if (simulatorChartInstance) simulatorChartInstance.destroy();
            simulatorChartInstance = new Chart(context, {
                type: 'line',
                data: {
                    labels: [...initialSimData.labels],
                    datasets: [
                        { label: 'Precio', data: [...initialSimData.price], borderColor: '#60a5fa', tension: 0.1, yAxisID: 'y' },
                        { label: 'Volumen', data: [...initialSimData.volume], type: 'bar', backgroundColor: '#4b5563', yAxisID: 'y1' }
                    ]
                },
                options: {
                    ...chartDefaultOptions,
                    scales: { ...chartDefaultOptions.scales, y: { ...chartDefaultOptions.scales.y, min: 48, max: 58 } },
                    plugins: { ...chartDefaultOptions.plugins, annotation: { annotations: {
                        resistance: { type: 'line', xMin: 1, xMax: 14, yMin: 52, yMax: 50.45, borderColor: 'rgb(239, 68, 68)', borderWidth: 2 },
                        support: { type: 'line', xMin: 2, xMax: 14, yMin: 49, yMax: 50.45, borderColor: 'rgb(34, 197, 94)', borderWidth: 2 }
                    } } }
                }
            });
        }
        
        function createFibonacciChart() {
            const fibonacciCtx = document.getElementById('fibonacciChart');
            if (!fibonacciCtx) return;
            const context = fibonacciCtx.getContext('2d');
            if (fibonacciChartInstance) fibonacciChartInstance.destroy();
            fibonacciChartInstance = new Chart(context, {
                type: 'line',
                data: {
                    labels: fibonacciData.labels,
                    datasets: [{
                        label: 'Precio',
                        data: fibonacciData.price,
                        borderColor: '#60a5fa',
                        fill: false,
                        tension: 0.1,
                        yAxisID: 'y',
                    }]
                },
                options: {
                    ...chartDefaultOptions,
                    scales: {
                        ...chartDefaultOptions.scales,
                        y: { ...chartDefaultOptions.scales.y, min: 90, max: 160 }
                    },
                    plugins: { ...chartDefaultOptions.plugins, annotation: { annotations: {} } }
                }
            });
        }
        
        function resetSimulation() {
            simState = { breakout: false, stoploss: false, target: false };
            createSimulatorChart();
            const step2 = document.getElementById('step-2');
            const step3 = document.getElementById('step-3');
            const step4 = document.getElementById('step-4');
            const step5 = document.getElementById('step-5');
            if (step2) step2.classList.remove('opacity-50');
            if (step3) step3.classList.add('opacity-50');
            if (step4) step4.classList.add('opacity-50');
            if (step5) step5.classList.add('opacity-50');
            const simulateBreakoutBtn = document.getElementById('simulate-breakout');
            const showStoplossBtn = document.getElementById('show-stoploss');
            const calculateTargetBtn = document.getElementById('calculate-target');
            if(simulateBreakoutBtn) simulateBreakoutBtn.disabled = false;
            if(showStoplossBtn) showStoplossBtn.disabled = true;
            if(calculateTargetBtn) calculateTargetBtn.disabled = true;
        }

        // Setup functions for each study
        function setupSymmetricTriangleStudy() {
            createAnatomyChart();
            createSimulatorChart();
            const anatomyButtons = document.getElementById('anatomy-buttons');
            const anatomyDescriptionEl = document.getElementById('anatomy-description');
            if (anatomyButtons && anatomyDescriptionEl) {
                anatomyButtons.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON' && !e.target.classList.contains('active')) {
                        const component = e.target.dataset.component;
                        anatomyButtons.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                        e.target.classList.add('active');
                        const desc = anatomyDescriptions[component];
                        anatomyDescriptionEl.classList.add('fade-out');
                        setTimeout(() => {
                            anatomyDescriptionEl.innerHTML = `<h3 class="font-bold text-white mb-2">${desc.title}</h3><p class="text-gray-300 text-sm">${desc.text}</p>`;
                            anatomyDescriptionEl.classList.remove('fade-out');
                        }, 300);
                        if (anatomyChartInstance) {
                            anatomyChartInstance.options.plugins.annotation.annotations = desc.annotations;
                            anatomyChartInstance.update();
                        }
                    }
                });
            }
            const simulateBreakoutBtn = document.getElementById('simulate-breakout');
            if (simulateBreakoutBtn) {
                simulateBreakoutBtn.addEventListener('click', () => {
                    if (simState.breakout) return;
                    simState.breakout = true;
                    const breakoutPrice = 52.5;
                    const newLabels = [...initialSimData.labels, 16];
                    const newPriceData = [...initialSimData.price, breakoutPrice];
                    const newVolumeData = [...initialSimData.volume, 180];
                    simulatorChartInstance.data.labels = newLabels;
                    simulatorChartInstance.data.datasets[0].data = newPriceData;
                    simulatorChartInstance.data.datasets[1].data = newVolumeData;
                    simulatorChartInstance.options.plugins.annotation.annotations.entry = {
                        type: 'point', xValue: 15, yValue: breakoutPrice, backgroundColor: 'rgba(34, 197, 94, 0.8)', borderColor: 'white', borderWidth: 2, radius: 6, label: { content: 'Entrada', enabled: true, position: 'start', yAdjust: -15, backgroundColor: 'rgba(0,0,0,0)', color: 'white' }
                    };
                    simulatorChartInstance.update();
                    const step3 = document.getElementById('step-3');
                    const step4 = document.getElementById('step-4');
                    const showStoplossBtn = document.getElementById('show-stoploss');
                    if(step3) step3.classList.remove('opacity-50');
                    if(step4) step4.classList.remove('opacity-50');
                    if(simulateBreakoutBtn) simulateBreakoutBtn.disabled = true;
                    if(showStoplossBtn) showStoplossBtn.disabled = false;
                });
            }
            const showStoplossBtn = document.getElementById('show-stoploss');
            if (showStoplossBtn) {
                showStoplossBtn.addEventListener('click', () => {
                    if (!simState.breakout || simState.stoploss) return;
                    simState.stoploss = true;
                    simulatorChartInstance.options.plugins.annotation.annotations.stoploss = {
                        type: 'line', xMin: 13, xMax: 18, yMin: 49, yMax: 49, borderColor: 'rgb(239, 68, 68)', borderWidth: 2, borderDash: [6, 6], label: { content: 'Stop-Loss', enabled: true, position: 'start', backgroundColor: 'rgba(0,0,0,0)', color: 'rgb(239, 68, 68)' }
                    };
                    simulatorChartInstance.update();
                    const step5 = document.getElementById('step-5');
                    const calculateTargetBtn = document.getElementById('calculate-target');
                    if(step5) step5.classList.remove('opacity-50');
                    if(showStoplossBtn) showStoplossBtn.disabled = true;
                    if(calculateTargetBtn) calculateTargetBtn.disabled = false;
                });
            }
            const calculateTargetBtn = document.getElementById('calculate-target');
            if (calculateTargetBtn) {
                calculateTargetBtn.addEventListener('click', () => {
                    if (!simState.stoploss || simState.target) return;
                    simState.target = true;
                    const baseHeight = 52 - 49;
                    const breakoutPoint = 52.5;
                    const targetPrice = breakoutPoint + baseHeight;
                    simulatorChartInstance.options.plugins.annotation.annotations.height = {
                        type: 'line', xMin: 2, xMax: 2, yMin: 49, yMax: 52, borderColor: '#a78bfa', borderDash: [6, 6], borderWidth: 2
                    };
                    simulatorChartInstance.options.plugins.annotation.annotations.projection = {
                        type: 'line', xMin: 15, xMax: 15, yMin: 52.5, yMax: targetPrice, borderColor: '#a78bfa', borderDash: [6, 6], borderWidth: 2
                    };
                    simulatorChartInstance.options.plugins.annotation.annotations.target = {
                        type: 'line', xMin: 15, xMax: 18, yMin: targetPrice, yMax: targetPrice, borderColor: 'rgb(34, 197, 94)', borderWidth: 2, borderDash: [6, 6], label: { content: `Objetivo: $${targetPrice.toFixed(1)}`, enabled: true, position: 'end', backgroundColor: 'rgba(0,0,0,0)', color: 'rgb(34, 197, 94)' }
                    };
                    simulatorChartInstance.update();
                    if(calculateTargetBtn) calculateTargetBtn.disabled = true;
                });
            }
            const resetSimulationBtn = document.getElementById('reset-simulation');
            if(resetSimulationBtn) resetSimulationBtn.addEventListener('click', resetSimulation);
        }

        function setupFibonacciRetracementStudy() {
            createFibonacciChart();
            const fibonacciButtons = document.getElementById('fibonacci-buttons');
            const fibonacciDescriptionEl = document.getElementById('fibonacci-description');
            if (fibonacciButtons && fibonacciDescriptionEl) {
                fibonacciButtons.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON' && !e.target.classList.contains('active')) {
                        const component = e.target.dataset.component;
                        fibonacciButtons.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                        e.target.classList.add('active');
                        const desc = fibonacciDescriptions[component];
                        fibonacciDescriptionEl.classList.add('fade-out');
                        setTimeout(() => {
                            fibonacciDescriptionEl.innerHTML = `<h3 class="font-bold text-white mb-2">${desc.title}</h3><p class="text-gray-300 text-sm">${desc.text}</p>`;
                            fibonacciDescriptionEl.classList.remove('fade-out');
                        }, 300);
                        if (fibonacciChartInstance) {
                            fibonacciChartInstance.options.plugins.annotation.annotations = desc.annotations;
                            fibonacciChartInstance.update();
                        }
                    }
                });
            }
        }

        // Main setup function for the education page
        function setupEducationCharts() {
            const triangleStudy = document.getElementById('symmetric-triangle-study');
            const fibonacciStudy = document.getElementById('fibonacci-study');
            const showTriangleBtn = document.getElementById('show-triangle-study');
            const showFibonacciBtn = document.getElementById('show-fibonacci-study');
            
            // Initial state
            let currentStudy = 'triangle';
            if (triangleStudy) triangleStudy.classList.remove('hidden');
            if (fibonacciStudy) fibonacciStudy.classList.add('hidden');
            setupSymmetricTriangleStudy();
            
            // Switch between studies
            if (showTriangleBtn) {
                showTriangleBtn.addEventListener('click', () => {
                    if (currentStudy !== 'triangle') {
                        if (triangleStudy) triangleStudy.classList.remove('hidden');
                        if (fibonacciStudy) fibonacciStudy.classList.add('hidden');
                        showTriangleBtn.classList.add('active');
                        showFibonacciBtn.classList.remove('active');
                        setupSymmetricTriangleStudy();
                        currentStudy = 'triangle';
                    }
                });
            }
            if (showFibonacciBtn) {
                showFibonacciBtn.addEventListener('click', () => {
                    if (currentStudy !== 'fibonacci') {
                        if (triangleStudy) triangleStudy.classList.add('hidden');
                        if (fibonacciStudy) fibonacciStudy.classList.remove('hidden');
                        showFibonacciBtn.classList.add('active');
                        showTriangleBtn.classList.remove('active');
                        setupFibonacciRetracementStudy();
                        currentStudy = 'fibonacci';
                    }
                });
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            // Element references
            const homePage = document.getElementById('home-page');
            const toolsPageContainer = document.getElementById('tools-page-container');
            const toolsContentContainer = document.getElementById('tools-content-container');
            const homeCardsGrid = document.getElementById('home-cards-grid');
            const homeIconBar = document.getElementById('home-icon-bar');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const closeMobileMenuButton = document.getElementById('close-mobile-menu');
            const mobileNavLinksContainer = document.getElementById('mobile-nav-links');

            // Data for all the tools/sections
            const tools = [
                { id: 'panorama-market-page', title: 'Panorama', description: 'Un vistazo general a los principales mercados y activos.', icon: `<img src="https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?auto=format&fit=crop&q=80&w=200&h=200" alt="Panorama" class="w-full h-full object-cover">` },
                { id: 'analisis-tecnico-page', title: 'An치lisis T칠cnico', description: 'Herramientas visuales para analizar la acci칩n del precio.', icon: `<img src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?auto=format&fit=crop&q=80&w=200&h=200" alt="An치lisis T칠cnico" class="w-full h-full object-cover">` },
                { id: 'chile-market-page', title: 'Chile', description: 'Sigue de cerca el S&P IPSA y las acciones locales.', icon: `<img src="https://flagcdn.com/cl.svg" alt="Bandera de Chile" class="w-full h-full object-contain p-2">` },
                { id: 'usa-market-page', title: 'USA', description: 'Analiza los gigantes de Wall Street con nuestro mapa de calor.', icon: `<img src="https://flagcdn.com/us.svg" width="40" alt="Bandera de EE.UU." class="w-full h-full object-contain p-2">` },
                { id: 'crypto-page', title: 'Cryptomonedas', description: 'Explora el mercado de cryptomonedas con nuestro mapa de calor.', icon: `<img src="https://images.unsplash.com/photo-1639322537228-f710d846310a?auto=format&fit=crop&q=80&w=200&h=200" alt="Cryptomonedas" class="w-full h-full object-cover">` },
                { id: 'noticias-page', title: 'Noticias', description: 'Las 칰ltimas noticias que mueven los mercados.', icon: `<img src="https://images.unsplash.com/photo-1495020689067-958852a7765e?auto=format&fit=crop&q=80&w=200&h=200" alt="Noticias" class="w-full h-full object-cover">` },
                { id: 'calendario-page', title: 'Calendario', description: 'Antic칤pate a los eventos econ칩micos clave.', icon: `<img src="https://images.unsplash.com/photo-1506784983877-45594efa4cbe?auto=format&fit=crop&q=80&w=200&h=200" alt="Calendario" class="w-full h-full object-cover">` },
                { id: 'educacion-page', title: 'Educaci칩n', description: 'Aprende los conceptos clave para invertir con confianza.', icon: `<img src="https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?auto=format&fit=crop&q=80&w=200&h=200" alt="Educaci칩n" class="w-full h-full object-cover">` },
                { id: 'contacto-page', title: 'Contacto', description: '쯊ienes preguntas? Ponte en contacto con nosotros.', icon: `<img src="https://images.unsplash.com/photo-1596526131083-e8c633c948d2?auto=format&fit=crop&q=80&w=200&h=200" alt="Contacto" class="w-full h-full object-cover">` }
            ];

            const loadedWidgets = new Set();
            let currentFileToUpload = null;

            // Function to dynamically create the initial UI from the `tools` array
            function createInitialUI() {
                // Create home page cards and mobile nav links
                tools.forEach((tool) => {
                    const card = document.createElement('div');
                    card.className = 'group bg-[#161B22] border border-gray-700 rounded-xl p-8 flex flex-col items-center text-center transform hover:-translate-y-2 transition-all duration-300 hover:border-blue-500 hover:shadow-2xl hover:shadow-blue-500/10';
                    card.innerHTML = `<div class="h-16 w-16 mb-6 rounded-full overflow-hidden transition-all duration-300 group-hover:scale-110 bg-gray-800 flex items-center justify-center">${tool.icon}</div><h3 class="text-xl font-semibold text-white mb-2">${tool.title}</h3><p class="text-gray-400 mb-6 flex-grow">${tool.description}</p><button data-page="${tool.id}" class="home-card-btn w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-300">Ver Secci칩n</button>`;
                    homeCardsGrid.appendChild(card);

                    const mobileLink = document.createElement('a');
                    mobileLink.href = '#';
                    mobileLink.className = 'mobile-nav-link text-gray-300 hover:text-white transition-colors py-2';
                    mobileLink.textContent = tool.title;
                    mobileLink.dataset.page = tool.id;
                    mobileNavLinksContainer.appendChild(mobileLink);
                });

                // Function to create a single ticker icon element
                const createTickerIcon = (tool) => {
                    const iconLink = document.createElement('a');
                    iconLink.href = '#';
                    iconLink.className = 'home-icon-link flex flex-row items-center gap-2 group';
                    iconLink.dataset.page = tool.id;
                    iconLink.innerHTML = `
                        <div class="w-8 h-8 rounded-full overflow-hidden flex items-center justify-center transform group-hover:scale-110 transition-all duration-300 flex-shrink-0 bg-gray-800">
                            ${tool.icon}
                        </div>
                        <span class="text-xs text-gray-400 group-hover:text-white transition-colors whitespace-nowrap">${tool.title}</span>
                    `;
                    return iconLink;
                };

                // Create two sets of icons for a seamless loop
                tools.forEach(tool => homeIconBar.appendChild(createTickerIcon(tool)));
                tools.forEach(tool => homeIconBar.appendChild(createTickerIcon(tool)));
            }

            // Switch view from home page to the tools page
            function showToolsPage(pageId) {
                homePage.classList.add('fade-out');

                setTimeout(() => {
                    homePage.style.display = 'none';
                    homePage.classList.remove('fade-out');
                    
                    toolsPageContainer.style.display = 'block';
                    toolsPageContainer.classList.add('fade-in');
                    showToolContent(pageId);
                }, 300);
            }

            // Display the content for a specific tool
            function showToolContent(pageId) {
                const template = document.getElementById(`template-${pageId}`);
                if (!template) return;

                // Show loader
                toolsContentContainer.innerHTML = `<div class="flex justify-center items-center h-64"><span class="loader"></span></div>`;

                // Simulate loading time for widgets
                setTimeout(() => {
                    if (document.querySelector(`#template-${pageId}`)) {
                        toolsContentContainer.innerHTML = template.innerHTML;
                        loadWidgetsForContent(pageId);
                    }
                }, 500); // 0.5 second delay

                // Update active icon state in the ticker
                document.querySelectorAll('.home-icon-link').forEach(link => {
                    link.classList.toggle('active', link.dataset.page === pageId);
                });

                window.scrollTo(0, 0);
            }

            // Mobile menu controls
            function openMobileMenu() { mobileMenu.classList.remove('translate-x-full'); }
            function closeMobileMenu() { mobileMenu.classList.add('translate-x-full'); }

            // Load TradingView widgets for the current page
            function loadWidgetsForContent(pageId) {
                // Special setup for the education page
                if (pageId === 'educacion-page') {
                    setupEducationCharts();
                }

                const widgetContainers = toolsContentContainer.querySelectorAll('.tradingview-widget-container__widget');
                widgetContainers.forEach(container => {
                    const widgetType = container.dataset.widgetType;
                    const widgetKey = `${pageId}-${widgetType}`;

                    // Avoid reloading widgets that are already loaded
                    if (loadedWidgets.has(widgetKey)) return;

                    let config = {};
                    let scriptSrc = '';

                    // Configuration for each widget type
                    switch(widgetType) {
                        case 'market-overview':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js';
                            config = { "colorTheme": "dark", "dateRange": "12M", "locale": "es", "largeChartUrl": "", "isTransparent": false, "showFloatingTooltip": true, "plotLineColorGrowing": "rgba(41, 98, 255, 1)", "plotLineColorFalling": "rgba(41, 98, 255, 1)", "gridLineColor": "rgba(240, 243, 250, 0)", "scaleFontColor": "#DBDBDB", "belowLineFillColorGrowing": "rgba(41, 98, 255, 0.12)", "belowLineFillColorFalling": "rgba(41, 98, 255, 0.12)", "belowLineFillColorGrowingBottom": "rgba(41, 98, 255, 0)", "belowLineFillColorFallingBottom": "rgba(41, 98, 255, 0)", "symbolActiveColor": "rgba(41, 98, 255, 0.12)", "tabs": [ { "title": "INDICES", "symbols": [ {"s": "CAPITALCOM:US500", "d": "S&P 500"}, {"s": "CAPITALCOM:US100", "d": "NASDAQ 100"}, {"s": "CAPITALCOM:US30", "d": "DOW JONES 30"}, {"s": "XETR:DAX", "d": "DAX"}, {"s": "BCS:SP_IPSA", "d": "IPSA"}, {"s": "BMFBOVESPA:IBOV", "d": "BOVESPA"}, {"s": "BCBA:IMV", "d": "MERVAL"} ], "originalTitle": "Indices" }, { "title": "COMMODITIES", "symbols": [ {"s": "CMCMARKETS:GOLD", "d": "ORO"}, {"s": "PYTH:WTI3!", "d": "PETROLEO"}, {"s": "CAPITALCOM:COPPER", "d": "COBRE"}, {"s": "CAPITALCOM:SILVER", "d": "PLATA"}, {"s": "CAPITALCOM:NATURALGAS", "d": "GAS NATURAL"} ], "originalTitle": "Futures" }, { "title": "DIVISAS", "symbols": [ {"s": "FX_IDC:USDCLP", "d": "USDCLP"}, {"s": "FX:EURUSD", "d": "EURUSD"}, {"s": "FX:USDJPY", "d": "USDJPY"}, {"s": "FX:GBPUSD", "d": "GBPUSD"}, {"s": "FX:USDCHF", "d": "USDCHF"} ], "originalTitle": "Forex" }, { "title": "CRYPTOMONEDAS", "symbols": [ {"s": "COINBASE:BTCUSD", "d": "BTCUSD"}, {"s": "COINBASE:ETHUSD", "d": "ETHUSD"}, {"s": "COINBASE:XRPUSD", "d": "XRPUSD"}, {"s": "COINBASE:SOLUSD", "d": "SOLUSD"}, {"s": "CRYPTOCAP:TOTAL", "d": "Crypto Total Market Cap"} ] } ], "width": "100%", "height": "100%", "showSymbolLogo": true, "showChart": true };
                            break;
                        case 'advanced-chart':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js';
                            config = { "autosize": true, "symbol": "BCS:SP_IPSA", "interval": "D", "timezone": "America/Santiago", "theme": "dark", "style": "1", "locale": "es", "allow_symbol_change": true, "calendar": true, "details": true, "hotlist": true, "hide_side_toolbar": false, "studies": ["Volume@tv-basicstudies", "RSI@tv-basicstudies"] };
                            break;
                        case 'heatmap-cl':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-stock-heatmap.js';
                            config = { "dataSource": "BCSSPIPSA", "blockSize": "market_cap_basic", "blockColor": "change", "grouping": "sector", "locale": "es", "symbolUrl": "", "colorTheme": "dark", "exchanges": [], "hasTopBar": true, "isDataSetEnabled": true, "isZoomEnabled": true, "hasSymbolTooltip": true, "isMonoSize": false, "width": "100%", "height": "100%" };
                            break;
                        case 'hotlists-cl':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-hotlists.js';
                            config = { "exchange": "BCS", "colorTheme": "dark", "dateRange": "12M", "showChart": true, "locale": "es", "isTransparent": true, "width": "100%", "height": "100%" };
                            break;
                        case 'heatmap-us':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-stock-heatmap.js';
                            config = { "dataSource": "SPX500", "blockSize": "market_cap_basic", "blockColor": "change", "grouping": "sector", "locale": "es", "symbolUrl": "", "colorTheme": "dark", "exchanges": [], "hasTopBar": true, "isDataSetEnabled": true, "isZoomEnabled": true, "hasSymbolTooltip": true, "isMonoSize": false, "width": "100%", "height": "100%" };
                            break;
                        case 'hotlists-us':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-hotlists.js';
                            config = { "exchange": "US", "colorTheme": "dark", "dateRange": "12M", "showChart": true, "locale": "es", "isTransparent": true, "width": "100%", "height": "100%" };
                            break;
                        case 'timeline':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-timeline.js';
                            config = { "feedMode": "all_symbols", "colorTheme": "dark", "isTransparent": true, "displayMode": "regular", "width": "100%", "height": "100%", "locale": "es" };
                            break;
                        case 'economic-calendar':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-events.js';
                            config = { "colorTheme": "dark", "isTransparent": false, "locale": "es", "countryFilter": "", "importanceFilter": "0,1", "width": "100%", "height": "100%" };
                            break;
                        case 'crypto-coins-heatmap':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-crypto-coins-heatmap.js';
                            config = { "dataSource": "Crypto", "blockSize": "market_cap_calc", "blockColor": "24h_close_change|5", "locale": "es", "symbolUrl": "", "colorTheme": "dark", "hasTopBar": true, "isDataSetEnabled": true, "isZoomEnabled": true, "hasSymbolTooltip": true, "isMonoSize": false, "width": "100%", "height": "100%" };
                            break;
                        case 'crypto-screener':
                            scriptSrc = 'https://s3.tradingview.com/external-embedding/embed-widget-screener.js';
                            config = { "defaultColumn": "overview", "screener_type": "crypto_mkt", "displayCurrency": "USD", "colorTheme": "dark", "isTransparent": false, "locale": "es", "width": "100%", "height": "100%" };
                            break;
                    }
                    
                    // Dynamically create and append the widget script
                    const script = document.createElement('script');
                    script.src = scriptSrc;
                    script.async = true;
                    script.innerHTML = JSON.stringify(config);
                    container.innerHTML = ''; // Clear container before adding the script
                    container.appendChild(script);
                    loadedWidgets.add(widgetKey);
                });
            }

            // --- Initialization and Event Listeners ---
            createInitialUI();

            // Function to handle returning to home page
            function returnToHome() {
                toolsPageContainer.classList.add('fade-out');

                setTimeout(() => {
                    toolsPageContainer.style.display = 'none';
                    toolsPageContainer.classList.remove('fade-out');

                    homePage.style.display = 'block';
                    homePage.classList.add('fade-in');
                    document.querySelectorAll('.home-icon-link').forEach(link => {
                        link.classList.remove('active');
                    });
                }, 300);

                window.scrollTo(0, 0);
            }

            // Use event delegation for click handling
            document.body.addEventListener('click', (e) => {
                const target = e.target.closest('.home-card-btn, .mobile-nav-link, .home-icon-link');
                if (target) {
                    e.preventDefault();
                    const pageId = target.dataset.page;
                    showToolsPage(pageId);
                    closeMobileMenu();
                }
            });

            // Logo click listener to return to the home page
            document.getElementById('logo-link').addEventListener('click', (e) => {
                e.preventDefault();
                returnToHome();
            });
            
            // Mobile menu button listeners
            mobileMenuButton.addEventListener('click', openMobileMenu);
            closeMobileMenuButton.addEventListener('click', closeMobileMenu);

            // --- Animated Particle Background Script ---
            const canvas = document.getElementById('particle-canvas');
            const ctx = canvas.getContext('2d');
            let particles = [];

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }

            function createParticles() {
                particles = [];
                let numberOfParticles = (canvas.height * canvas.width) / 9000;
                for(let i = 0; i < numberOfParticles; i++) {
                    particles.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        vx: Math.random() * 0.5 - 0.25,
                        vy: Math.random() * 0.5 - 0.25,
                        radius: Math.random() * 1.5
                    });
                }
            }

            function drawParticles() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                particles.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    ctx.fill();
                });
            }

            function updateParticles() {
                particles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;

                    if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
                });
            }

            function animate() {
                drawParticles();
                updateParticles();
                requestAnimationFrame(animate);
            }

            window.addEventListener('resize', () => {
                resizeCanvas();
                createParticles();
            });

            resizeCanvas();
            createParticles();
            animate();
        });
    </script>
</body>
</html>

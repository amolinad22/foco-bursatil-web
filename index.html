<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foco Bursátil - Noticias y Análisis de Mercado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0D1117; /* Un fondo oscuro principal */
            color: #C9D1D9; /* Color de texto principal */
        }
        .bg-card {
            background-color: #161B22; /* Color de fondo para tarjetas y secciones */
        }
        .border-card {
            border-color: #30363D; /* Color de borde */
        }
        .text-gold {
            color: #D4AF37; /* Un toque dorado inspirado en el logo */
        }
        .bg-gold {
            background-color: #D4AF37;
        }
        .text-blue-accent {
            color: #3B82F6; /* Un azul inspirado en el logo */
        }
        .bg-blue-accent {
            background-color: #3B82F6;
        }
        /* Estilos para la caja de sugerencias */
        #suggestions-box {
            position: absolute;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #30363D;
            border-top: none;
            z-index: 10;
            text-align: left;
        }
        .suggestion-item {
            padding: 10px;
            cursor: pointer;
            background-color: #161B22;
            color: #C9D1D9;
        }
        .suggestion-item:hover {
            background-color: #30363D;
        }
        .suggestion-name {
            font-size: 0.8rem;
            color: #8B949E;
        }
        /* Estilo para la pestaña activa */
        .nav-link.active {
            color: #D4AF37;
            font-weight: 600;
        }
        /* Evita el parpadeo de los widgets de TradingView al cargar */
        .tradingview-widget-container {
            min-height: 60px; /* Ajusta según la altura mínima de tus widgets */
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header -->
    <header class="bg-card border-b border-card sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <nav class="flex justify-between items-center py-3">
                <!-- Logo -->
                <a href="#" class="flex items-center space-x-2">
                    <img src="https://storage.googleapis.com/gemini-generative-ai-public-data/Gemini_Generated_Image_jndg04jndg04jndg.jpg" alt="Logo Foco Bursátil" class="h-12 w-auto">
                </a>

                <!-- Menú de Navegación (Desktop) -->
                <div id="desktop-nav" class="hidden md:flex items-center space-x-6 lg:space-x-8">
                    <a href="#" class="nav-link text-gray-300 hover:text-gold transition duration-300 flex items-center" data-target="mercados-section"><i data-feather="trending-up" class="w-4 h-4 mr-2"></i>Mercados</a>
                    <a href="#" class="nav-link text-gray-300 hover:text-gold transition duration-300 flex items-center" data-target="chile-section"><img src="https://flagcdn.com/w20/cl.png" alt="Bandera de Chile" class="w-5 h-auto mr-2">Chile</a>
                    <a href="#" class="nav-link text-gray-300 hover:text-gold transition duration-300 flex items-center" data-target="usa-section"><img src="https://flagcdn.com/w20/us.png" alt="Bandera de USA" class="w-5 h-auto mr-2">USA</a>
                    <a href="#" class="nav-link text-gray-300 hover:text-gold transition duration-300 flex items-center" data-target="noticias-section"><i data-feather="globe" class="w-4 h-4 mr-2"></i>Noticias</a>
                    <a href="#" class="nav-link text-gray-300 hover:text-gold transition duration-300 flex items-center" data-target="calendario-section"><i data-feather="calendar" class="w-4 h-4 mr-2"></i>Calendario</a>
                    <a href="#" class="nav-link text-gray-300 hover:text-gold transition duration-300 flex items-center" data-target="criptomonedas-section"><i data-feather="dollar-sign" class="w-4 h-4 mr-2"></i>Criptomonedas</a>
                    <a href="#" class="nav-link text-gray-300 hover:text-gold transition duration-300 flex items-center" data-target="educacion-section"><i data-feather="book-open" class="w-4 h-4 mr-2"></i>Educación</a>
                </div>

                <!-- Acciones y Menú Móvil -->
                <div class="flex items-center space-x-4">
                    <a href="#ticker-input" class="text-gray-300 hover:text-gold transition duration-300">
                        <i data-feather="search" class="w-5 h-5"></i>
                    </a>
                    <button id="mobile-menu-button" class="md:hidden text-gray-300 hover:text-gold transition duration-300">
                        <i data-feather="menu" class="w-6 h-6"></i>
                    </button>
                </div>
            </nav>
        </div>
        <!-- Menú de Navegación (Móvil) -->
        <div id="mobile-menu" class="hidden md:hidden bg-card border-t border-card">
            <a href="#" class="nav-link block px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white" data-target="mercados-section">Mercados</a>
            <a href="#" class="nav-link block px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white" data-target="chile-section">Chile</a>
            <a href="#" class="nav-link block px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white" data-target="usa-section">USA</a>
            <a href="#" class="nav-link block px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white" data-target="noticias-section">Noticias</a>
            <a href="#" class="nav-link block px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white" data-target="calendario-section">Calendario</a>
            <a href="#" class="nav-link block px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white" data-target="criptomonedas-section">Criptomonedas</a>
            <a href="#" class="nav-link block px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white" data-target="educacion-section">Educación</a>
        </div>
    </header>

    <!-- Ticker de Mercado con Widget de TradingView -->
    <div class="tradingview-widget-container">
      <div class="tradingview-widget-container__widget"></div>
      <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
      {
      "symbols": [
        { "proName": "SP_IPSA", "title": "S&P IPSA" },
        { "proName": "NYSE:SQM", "title": "SQM (ADR)" },
        { "proName": "BCS:FALABELLA", "title": "Falabella" },
        { "proName": "BCS:COPEC", "title": "Copec" },
        { "proName": "FOREXCOM:SPXUSD", "title": "S&P 500" },
        { "proName": "FOREXCOM:NSXUSD", "title": "Nasdaq 100" },
        { "proName": "BITSTAMP:BTCUSD", "title": "Bitcoin" },
        { "proName": "FX_IDC:USDCLP", "title": "USD/CLP" }
      ],
      "showSymbolLogo": true,
      "colorTheme": "dark",
      "isTransparent": true,
      "displayMode": "adaptive",
      "locale": "es"
    }
      </script>
    </div>
    <!-- Fin del Widget de TradingView -->


    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8 md:py-12">

        <!-- SECCIÓN DE MERCADOS (Visible por defecto) -->
        <div id="mercados-section" class="page-section">
            <!-- Hero Section -->
            <section class="grid grid-cols-1 gap-12 mb-16">
                <div class="text-center">
                    <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold mb-4 leading-tight">
                        El <span class="text-blue-accent">Pulso</span> del Mercado en <span class="text-gold">Tiempo Real</span>
                    </h1>
                    <p class="text-lg text-gray-400 mb-8 max-w-3xl mx-auto">Análisis, noticias y herramientas para que tomes las mejores decisiones financieras. Tu fuente de información confiable en el mundo de las inversiones.</p>
                    
                    <!-- Campo de búsqueda con autocompletar -->
                    <div class="relative max-w-xl mx-auto">
                        <div class="flex flex-col sm:flex-row gap-2 mt-8">
                            <div class="relative w-full sm:w-auto flex-grow">
                                <input type="text" id="ticker-input" placeholder="Buscar símbolo (ej: AAPL, FALABELLA)" class="w-full bg-card border border-card rounded-md px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-accent">
                                <div id="suggestions-box" class="hidden rounded-b-md"></div>
                            </div>
                            <button id="search-button" class="bg-blue-accent text-white px-6 py-3 rounded-md font-semibold hover:bg-opacity-90 transition duration-300 flex items-center justify-center gap-2">
                                <i data-feather="search" class="w-5 h-5"></i>
                                Buscar
                            </button>
                        </div>
                    </div>
                </div>
                <div id="main-chart-container" class="w-full h-[600px]">
                     <!-- Gráfico Avanzado de TradingView -->
                    <div class="tradingview-widget-container h-full">
                      <div id="tradingview_chart_advanced" class="h-full"></div>
                    </div>
                    <!-- Fin del Widget -->
                </div>
            </section>

            <!-- NUEVO: Ganadoras y Perdedoras -->
            <section class="mt-16">
                <h2 class="text-3xl font-bold mb-8 border-l-4 border-gold pl-4">Principales Movimientos del Mercado</h2>
                <div class="tradingview-widget-container">
                    <div class="tradingview-widget-container__widget"></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-screener.js" async>
                    {
                    "width": "100%",
                    "height": 490,
                    "defaultColumn": "overview",
                    "screener_type": "market",
                    "displayCurrency": "USD",
                    "colorTheme": "dark",
                    "locale": "es",
                    "isTransparent": true,
                    "market": "us"
                    }
                    </script>
                </div>
            </section>

            <!-- Panorama de los Mercados -->
            <section class="mt-16">
                <h2 class="text-3xl font-bold mb-8 border-l-4 border-gold pl-4">Panorama de los Mercados</h2>
                <div class="tradingview-widget-container">
                  <div class="tradingview-widget-container__widget"></div>
                  <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
                  {
                  "colorTheme": "dark",
                  "dateRange": "12M",
                  "showChart": true,
                  "locale": "es",
                  "largeChartUrl": "",
                  "isTransparent": true,
                  "showSymbolLogo": true,
                  "showFloatingTooltip": false,
                  "width": "100%",
                  "height": "660",
                  "plotLineColorGrowing": "rgba(41, 98, 255, 1)",
                  "plotLineColorFalling": "rgba(41, 98, 255, 1)",
                  "gridLineColor": "rgba(240, 243, 250, 0)",
                  "scaleFontColor": "rgba(120, 123, 134, 1)",
                  "belowLineFillColorGrowing": "rgba(41, 98, 255, 0.12)",
                  "belowLineFillColorFalling": "rgba(41, 98, 255, 0.12)",
                  "belowLineFillColorGrowingBottom": "rgba(41, 98, 255, 0)",
                  "belowLineFillColorFallingBottom": "rgba(41, 98, 255, 0)",
                  "symbolActiveColor": "rgba(41, 98, 255, 0.12)",
                  "tabs": [
                    {
                      "title": "Índices",
                      "symbols": [
                        { "s": "SP_IPSA", "d": "S&P IPSA" },
                        { "s": "FOREXCOM:SPXUSD", "d": "S&P 500" },
                        { "s": "FOREXCOM:NSXUSD", "d": "US 100" },
                        { "s": "TVC:VIX", "d": "Índice de Volatilidad VIX" },
                        { "s": "INDEX:DEU40", "d": "DAX" },
                        { "s": "INDEX:JPN225", "d": "Nikkei 225" }
                      ],
                      "originalTitle": "Indices"
                    },
                    {
                      "title": "Sectores USA",
                      "symbols": [
                        { "s": "AMEX:XLE", "d": "Energía" },
                        { "s": "AMEX:XLF", "d": "Financiero" },
                        { "s": "AMEX:XLK", "d": "Tecnología" },
                        { "s": "AMEX:XLI", "d": "Industrial" },
                        { "s": "AMEX:XLU", "d": "Servicios Públicos" },
                        { "s": "AMEX:XLV", "d": "Salud" }
                      ],
                      "originalTitle": "Sectors"
                    },
                    {
                      "title": "Divisas",
                      "symbols": [
                        { "s": "FX_IDC:USDCLP", "d": "Dólar/Peso Chileno" },
                        { "s": "FX:EURUSD", "d": "EUR/USD" },
                        { "s": "FX:USDJPY", "d": "USD/JPY" },
                        { "s": "FX:GBPUSD", "d": "GBP/USD" }
                      ],
                      "originalTitle": "Forex"
                    },
                    {
                      "title": "Materias Primas",
                      "symbols": [
                        { "s": "COMEX:GC1!", "d": "Oro" },
                        { "s": "COMEX:SI1!", "d": "Plata" },
                        { "s": "COMEX:HG1!", "d": "Cobre" },
                        { "s": "NYMEX:CL1!", "d": "Petróleo Crudo" }
                      ],
                      "originalTitle": "Commodities"
                    }
                  ]
                }
                  </script>
                </div>
            </section>
        </div>

        <!-- SECCIÓN DE CHILE -->
        <div id="chile-section" class="page-section hidden">
            <h2 class="text-3xl font-bold mb-8 border-l-4 border-gold pl-4">Mercado Chileno</h2>
            <div class="tradingview-widget-container h-[800px]">
              <div class="tradingview-widget-container__widget"></div>
              <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-quotes.js" async>
              {
              "width": "100%",
              "height": "100%",
              "symbolsGroups": [
                {
                  "name": "Acciones Principales (IPSA)",
                  "symbols": [
                    { "name": "BCS:IPSA" }, { "name": "BCS:SQM-B" }, { "name": "BCS:FALABELLA" }, { "name": "BCS:COPEC" }, { "name": "BCS:CMPC" }, { "name": "BCS:CENCOSUD" }, { "name": "BCS:BCI" }, { "name": "BCS:CHILE" }, { "name": "BCS:BSANTANDER" }, { "name": "BCS:VAPORES" }, { "name": "BCS:ENELAM" }, { "name": "BCS:LTM" }, { "name": "BCS:RIPLEY" }, { "name": "BCS:CONCHATORO" }, { "name": "BCS:IAM" }, { "name": "BCS:PARAUCO" }
                  ]
                }
              ],
              "showSymbolLogo": true,
              "colorTheme": "dark",
              "isTransparent": true,
              "locale": "es"
            }
              </script>
            </div>
        </div>

        <!-- SECCIÓN DE USA -->
        <div id="usa-section" class="page-section hidden">
            <h2 class="text-3xl font-bold mb-8 border-l-4 border-gold pl-4">Mercado de EE.UU.</h2>
            <div class="tradingview-widget-container h-[800px]">
              <div class="tradingview-widget-container__widget"></div>
              <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-quotes.js" async>
              {
              "width": "100%",
              "height": "100%",
              "symbolsGroups": [
                {
                  "name": "Tecnología",
                  "symbols": [
                    { "name": "NASDAQ:AAPL" }, { "name": "NASDAQ:GOOGL" }, { "name": "NASDAQ:MSFT" }, { "name": "NASDAQ:TSLA" }, { "name": "NASDAQ:AMZN" }, { "name": "NASDAQ:NVDA" }, { "name": "NASDAQ:META" }
                  ]
                },
                {
                  "name": "Finanzas y Pagos",
                  "symbols": [
                    { "name": "NYSE:JPM" }, { "name": "NYSE:V" }, { "name": "NYSE:MA" }, { "name": "NYSE:BAC" }, { "name": "NYSE:WFC" }
                  ]
                },
                {
                  "name": "Consumo y Entretenimiento",
                  "symbols": [
                    { "name": "NYSE:DIS" }, { "name": "NYSE:WMT" }, { "name": "NYSE:NKE" }, { "name": "NASDAQ:NFLX" }, { "name": "NYSE:KO" }
                  ]
                }
              ],
              "showSymbolLogo": true,
              "colorTheme": "dark",
              "isTransparent": true,
              "locale": "es"
            }
              </script>
            </div>
        </div>

        <!-- SECCIÓN DE NOTICIAS -->
        <div id="noticias-section" class="page-section hidden">
            <h2 class="text-3xl font-bold mb-8 border-l-4 border-gold pl-4">Noticias del Mercado</h2>
            <div class="tradingview-widget-container">
              <div class="tradingview-widget-container__widget"></div>
              <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-timeline.js" async>
              {
              "feedMode": "all_symbols",
              "colorTheme": "dark",
              "isTransparent": true,
              "displayMode": "adaptive",
              "width": "100%",
              "height": 800,
              "locale": "es"
            }
              </script>
            </div>
        </div>

        <!-- NUEVA SECCIÓN: CALENDARIO ECONÓMICO -->
        <div id="calendario-section" class="page-section hidden">
            <h2 class="text-3xl font-bold mb-8 border-l-4 border-gold pl-4">Calendario Económico</h2>
            <div class="tradingview-widget-container">
                <div class="tradingview-widget-container__widget"></div>
                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-events.js" async>
                {
                "colorTheme": "dark",
                "isTransparent": true,
                "width": "100%",
                "height": 600,
                "locale": "es",
                "importanceFilter": "0,1"
                }
                </script>
            </div>
        </div>

        <!-- SECCIÓN DE CRIPTOMONEDAS -->
        <div id="criptomonedas-section" class="page-section hidden">
             <h2 class="text-3xl font-bold mb-8 border-l-4 border-gold pl-4">Criptomonedas</h2>
             <div id="crypto-heatmap-container" class="tradingview-widget-container h-[600px]">
                 <!-- El widget se cargará aquí dinámicamente -->
             </div>
        </div>

        <!-- SECCIÓN DE EDUCACIÓN -->
        <div id="educacion-section" class="page-section hidden">
             <h2 class="text-3xl font-bold mb-8 border-l-4 border-gold pl-4">Educación Financiera</h2>
             <p>Contenido de educación financiera próximamente...</p>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-card border-t border-card mt-16">
        <div class="container mx-auto px-4 py-8">
            <div class="grid md:grid-cols-3 gap-8 text-center md:text-left">
                <div>
                    <a href="#" class="flex items-center justify-center md:justify-start space-x-2 mb-4">
                        <img src="https://storage.googleapis.com/gemini-generative-ai-public-data/Gemini_Generated_Image_jndg04jndg04jndg.jpg" alt="Logo Foco Bursátil" class="h-10 w-auto">
                    </a>
                    <p class="text-gray-400 text-sm">Información y análisis para tus decisiones financieras.</p>
                </div>
                <div>
                    <h5 class="font-bold text-lg mb-4 text-gold">Secciones</h5>
                    <ul class="space-y-2">
                        <li><a href="#" class="nav-link text-gray-400 hover:text-white" data-target="mercados-section">Mercados</a></li>
                        <li><a href="#" class="nav-link text-gray-400 hover:text-white" data-target="noticias-section">Noticias</a></li>
                        <li><a href="#" class="nav-link text-gray-400 hover:text-white" data-target="calendario-section">Calendario</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="font-bold text-lg mb-4 text-gold">Síguenos</h5>
                    <div class="flex justify-center md:justify-start space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white"><i data-feather="twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i data-feather="youtube"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i data-feather="linkedin"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-card mt-8 pt-6 text-center text-sm text-gray-500">
                <p>&copy; 2024 Foco Bursátil. Todos los derechos reservados.</p>
                <p class="mt-1">La información aquí presentada no constituye una recomendación de inversión.</p>
            </div>
        </div>
    </footer>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- INICIALIZACIÓN GENERAL ---
            feather.replace();
            initMobileMenu();
            initSymbolSearch();
            initNavigationTabs();

            // --- LÓGICA DEL MENÚ MÓVIL ---
            function initMobileMenu() {
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileMenu = document.getElementById('mobile-menu');
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }

            // --- LÓGICA DE BÚSQUEDA DE SÍMBOLOS Y GRÁFICO PRINCIPAL ---
            function initSymbolSearch() {
                const searchButton = document.getElementById('search-button');
                const tickerInput = document.getElementById('ticker-input');
                const suggestionsBox = document.getElementById('suggestions-box');
                let mainChartWidget = null;

                // Lista de símbolos para autocompletar (mejorada y más extensa)
                const stockList = [
                    // Chile
                    { symbol: 'BCS:FALABELLA', name: 'Falabella SA' }, { symbol: 'BCS:SQM-B', name: 'SQM' }, { symbol: 'BCS:COPEC', name: 'Empresas Copec SA' }, { symbol: 'BCS:CMPC', name: 'Empresas CMPC SA' }, { symbol: 'BCS:CENCOSUD', name: 'Cencosud SA' }, { symbol: 'BCS:BCI', name: 'Banco de Crédito e Inversiones' }, { symbol: 'BCS:CHILE', name: 'Banco de Chile' }, { symbol: 'BCS:BSANTANDER', name: 'Banco Santander Chile' }, { symbol: 'BCS:VAPORES', name: 'CSAV' }, { symbol: 'BCS:ENELAM', name: 'Enel Américas SA' }, { symbol: 'BCS:LTM', name: 'LATAM Airlines' }, { symbol: 'BCS:RIPLEY', name: 'Ripley Corp SA' }, { symbol: 'BCS:CONCHATORO', name: 'Viña Concha y Toro' },
                    // USA
                    { symbol: 'AAPL', name: 'Apple Inc.' }, { symbol: 'GOOGL', name: 'Alphabet Inc.' }, { symbol: 'MSFT', name: 'Microsoft' }, { symbol: 'TSLA', name: 'Tesla, Inc.' }, { symbol: 'AMZN', name: 'Amazon.com' }, { symbol: 'NVDA', name: 'NVIDIA' }, { symbol: 'META', name: 'Meta Platforms' }, { symbol: 'JPM', name: 'JPMorgan Chase' }, { symbol: 'V', name: 'Visa Inc.' }, { symbol: 'DIS', name: 'Walt Disney' }, { symbol: 'XOM', name: 'Exxon Mobil' }, { symbol: 'BRK.B', name: 'Berkshire Hathaway' }, { symbol: 'JNJ', name: 'Johnson & Johnson' }, { symbol: 'WMT', name: 'Walmart Inc.' },
                    // Índices y otros
                    { symbol: 'SP_IPSA', name: 'S&P IPSA Chile' }, { symbol: 'FOREXCOM:SPXUSD', name: 'S&P 500' }, { symbol: 'FOREXCOM:NSXUSD', name: 'Nasdaq 100' }, { symbol: 'TVC:VIX', name: 'Volatility Index' }, { symbol: 'BITSTAMP:BTCUSD', name: 'Bitcoin / USD' }, { symbol: 'FX_IDC:USDCLP', name: 'Dólar / Peso Chileno' }
                ];

                const createMainChartWidget = (ticker) => {
                    const container = document.getElementById('tradingview_chart_advanced');
                    if (!container) {
                        console.error("El contenedor del gráfico principal no se encontró.");
                        return;
                    }
                    container.innerHTML = ''; // Limpiar antes de crear uno nuevo
                    mainChartWidget = new TradingView.widget({
                        "autosize": true,
                        "symbol": ticker,
                        "interval": "D",
                        "timezone": "Etc/UTC",
                        "theme": "dark",
                        "style": "1",
                        "locale": "es",
                        "enable_publishing": false,
                        "allow_symbol_change": true,
                        "withdateranges": true,
                        "hide_side_toolbar": false,
                        "details": true,
                        "hotlist": true,
                        "calendar": true,
                        "news": ["headlines"],
                        "studies": ["MASimple@tv-basicstudies", "RSI@tv-basicstudies"],
                        "container_id": "tradingview_chart_advanced"
                    });
                };

                const performSearch = () => {
                    const ticker = tickerInput.value.trim().toUpperCase();
                    if (ticker) {
                        createMainChartWidget(ticker);
                        suggestionsBox.classList.add('hidden');
                        tickerInput.blur(); // Quita el foco del input
                    }
                };

                tickerInput.addEventListener('input', () => {
                    const inputText = tickerInput.value.trim().toUpperCase();
                    suggestionsBox.innerHTML = '';

                    if (inputText.length === 0) {
                        suggestionsBox.classList.add('hidden');
                        return;
                    }

                    const filteredStocks = stockList.filter(stock =>
                        stock.symbol.toUpperCase().includes(inputText) ||
                        stock.name.toUpperCase().includes(inputText)
                    ).slice(0, 5); // Limitar a 5 sugerencias

                    if (filteredStocks.length > 0) {
                        suggestionsBox.classList.remove('hidden');
                        filteredStocks.forEach(stock => {
                            const item = document.createElement('div');
                            item.classList.add('suggestion-item');
                            item.innerHTML = `<strong>${stock.symbol}</strong><div class="suggestion-name">${stock.name}</div>`;
                            item.addEventListener('click', () => {
                                tickerInput.value = stock.symbol;
                                performSearch();
                            });
                            suggestionsBox.appendChild(item);
                        });
                    } else {
                        suggestionsBox.classList.add('hidden');
                    }
                });

                document.addEventListener('click', (event) => {
                    if (!event.target.closest('.relative')) {
                        suggestionsBox.classList.add('hidden');
                    }
                });

                searchButton.addEventListener('click', performSearch);
                tickerInput.addEventListener('keypress', (event) => {
                    if (event.key === 'Enter') {
                        performSearch();
                    }
                });

                // Cargar el widget inicial
                createMainChartWidget('SP_IPSA');
            }

            // --- LÓGICA DE NAVEGACIÓN POR PESTAÑAS ---
            function initNavigationTabs() {
                const navLinks = document.querySelectorAll('.nav-link');
                const pageSections = document.querySelectorAll('.page-section');
                const widgetLoadStatus = {
                    'criptomonedas-section': false
                };

                const loadWidget = (targetId) => {
                    if (targetId === 'criptomonedas-section' && !widgetLoadStatus[targetId]) {
                        new TradingView.widget({
                            "dataSource": "Crypto",
                            "blockSize": "market_cap_calc",
                            "blockColor": "24h_close_change|5",
                            "locale": "es",
                            "colorTheme": "dark",
                            "isTransparent": true,
                            "width": "100%",
                            "height": "100%",
                            "container_id": "crypto-heatmap-container"
                        });
                        widgetLoadStatus[targetId] = true;
                    }
                    // Se pueden agregar más cargas de widgets "lazy" aquí
                };

                const showSection = (targetId) => {
                    pageSections.forEach(section => section.classList.add('hidden'));
                    
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.classList.remove('hidden');
                    }

                    loadWidget(targetId);

                    navLinks.forEach(link => {
                        link.classList.toggle('active', link.dataset.target === targetId);
                    });
                };

                navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetId = e.currentTarget.dataset.target;
                        if (targetId) {
                            showSection(targetId);
                            // Cierra el menú móvil si está abierto
                            document.getElementById('mobile-menu').classList.add('hidden');
                        }
                    });
                });

                // Mostrar la primera sección por defecto
                showSection('mercados-section');
            }
        });
    </script>
</body>
</html>
